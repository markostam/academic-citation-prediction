IMRP International Mathematics Research Papers
Volume 2006, Article ID 72017, Pages 1–57
Computing Zeta Functions of Nondegenerate Curves
W. Castryck, J. Denef, and F. Vercauteren
We present a p-adic algorithm to compute the zeta function of a nondegenerate curve
over a finite field using Monsky-Washnitzer cohomology. The paper vastly generalizes
previouswork since in practice all known cases, for example, hyperelliptic, superelliptic,
and Cab curves, can be transformed to fit the nondegenerate case. For curves with a fixed
Newton polytope, the property of being nondegenerate is generic, so that the algorithm
works for almost all curves with given Newton polytope. For a genus g curve over Fpn ,
the expected running time is ˜O(n3g6 +n2g6.5),whereas the space complexity amounts to
˜O(n3g4), assuming p is fixed.
1 Introduction
An important research topic in computational number theory is the determination of the
number of rational points on an algebraic curve C over a finite field Fpn . More generally,
one is interested in the computation of its Hasse-Weil zeta function
ZC(t) = exp
(
∞
∑
k=1
#C
(
Fpnk
)tk
k
)
∈ Q[[t]], (1.1)
which turns out to be a rational function [11] (and hence a finite computable object)
Received 23 December 2005; Revised 14 September 2006; Accepted 9 November 2006
Communicated by Kiran S. Kedlaya
2 W. Castryck et al.
that contains a huge amount of arithmetic and geometric information about C. For in-
stance, if one wants to use a cryptosystem based on the discrete logarithm problem on
the Jacobian variety Jac(C), one should be able to compute the cardinality of its set of
rational points, which is fully determined by ZC(t). Eﬃcient point counting algorithms
can also provide important heuristical (counter) evidence for several conjectures con-
cerning the asymptotic behavior of the number of points on algebraic curves (see, e.g.,
[15, 24, 38]).
Mainly because of its applications in cryptography, a significant amount of work
has been done in the field of elliptic curve point counting. This roughly resulted in two
types of algorithms. Schoof developed a so-called -adic algorithm [41], using torsion
points to determine the number of points modulo small primes  = p. This algorithm has
polynomial running time in the input size ∼ n logp. On the other hand, Satoh invented
a p-adic method [40], using the Serre-Tate canonical lift of the curve. Unlike Schoof’s al-
gorithm, its running time is exponential in logp. For fixed (small) p however, it is much
faster, especially due to several improvements made in the past few years (see [45] for an
overview).
Generalizing the above techniques to curves of any genus is a nontrivial task,
since both methods make explicit use of the geometry of elliptic curves. Another concern
is that the resulting algorithm should also have a good time complexity in the genus g
of the input curve, as its size should now be measured as ∼ gn logp. So far, all attempts
using the -adic approach yield impractical algorithms for g > 2 (see [16] for a treatment
of the g = 2 case, see also [21, 22, 37]), but the p-adic story is more successful. Kedlaya
found a nonobvious way to “generalize” Satoh’s method to hyperelliptic curves of any
genus1 [25], using a rigid analytical lift instead of the canonical lift. The big technical
tool behind Kedlaya’s algorithm is Monsky-Washnitzer cohomology (see [34–36] and the
survey by van der Put [44]).
A particularly nice aspect of Kedlaya’s method is that there are no obvious the-
oretical obstructions for generalizations to larger classes of curves. This observation
soon resulted in point counting algorithms for superelliptic curves [17] and Cab curves
[10]. In the present paper, we vastly generalize the previous by presenting an algorithm
that determines the zeta function of so-called nondegenerate curves. These are curves
in (A1
Fpn
\ {0})2 that are defined by a Laurent polynomial f ∈ Fpn [x±1, y±1] that is non-
degenerate with respect to its Newton polytope. We refer to Section 2 for the definition
but mention here already that this condition is satisfied for generically chosen Laurent
polynomials with given Newton polytope.
1This was over finite fields of odd characteristic. The characteristic 2case was treated in [9].
Computing Zeta Functions of Nondegenerate Curves 3
The main result can be formulated as follows.
Theorem 1.1. There exists a deterministic algorithm to compute the zeta function of a
genus g nondegenerate curve over Fpn that requires ˜O(n3Ψt) bit-operations and ˜O(n3Ψs)
space for p fixed. Here, Ψt and Ψs are parameters that depend on the Newton polytope of
the input curve only; for “most common” Newton polytopes, Ψt = ˜O(g6.5) and Ψs = ˜O(g4).

For explicit formulas for Ψt and Ψs we refer to Theorem 7.3 (Section 7). Recall that the
Soft-Oh notation ˜O neglects factors that are logarithmic in the input size. The notion
“most common” is not intended to be made mathematically exact. It just means that the
Newton polytope should not be shaped too exotically. We refer to Section 7 for more de-
tails.
It is worth remarking that Kedlaya’s method is not the only p-adic point counting
technique that is being investigated for higher genus. Mestre adapted his so-called AGM
method to ordinary hyperelliptic curves of any genus over finite fields of characteristic
two [33]; it has been optimized by Lercier and Lubicz [32],while Ritzenthaler extended it
to nonhyperelliptic curves of genus three [39]. These algorithms have running time ˜O(n2)
(for fixed p and g) but are exponential in the genus. Another interesting approach is to
combine Kedlaya’s ideas with Dwork’s deformation theory [12]. This was first proposed
by Lauder [31] and has been studied in more detail by Lauder himself [30], Gerkmann
[18], and Hubrechts,who recently obtained a memory eﬃcient version of Kedlaya’s origi-
nal algorithm [23]. Independently, Tsuzuki used similar ideas for computing certain one-
dimensional Kloosterman sums [43].
The remainder of this paper is organized as follows: Section 2 recalls the defi-
nition of nondegenerate curves, illustrates that a wealth of information is contained in
the Newton polytope and ends with a new result on the eﬀective Nullstellensatz prob-
lem. Section 3 contains a novel method to explicitly compute a basis of the first Monsky-
Washnitzer cohomology group and Section 4 describes an algorithm to lift the Frobe-
nius endomorphism. An algorithm to computemodulo exact diﬀerential forms is given in
Section 5. Section 6 discusses the simplifications when the curve is commode andmonic.
Finally, Section 7 contains the detailed algorithmand complexity estimates and Section 8
concludes the paper.
Preliminaries. Instead of giving a concise re´sume´ of the cohomology theory of Mon-
sky and Washnitzer, we immediately refer to the survey by van der Put [44] (or to the
short overviews given in, e.g., [25] or [10]). The idea behind the present algorithm is then
simply to compute all terms in the Lefschetz fixed-point formula [44, Formula (1.2)]
(or [25, Theorem 1] or [10, Theorem 1])modulo a certain p-adic precision.
4 W. Castryck et al.
Notations and conventions. Throughout this paper, x and y are fixed formal variables.
For any integral domain R and any subset S ⊂ R2,we denote by R[S] the ring generated by
the monomials that are supported in S, that is,
R
[
xiyj | (i, j) ∈ S ∩ Z2]. (1.2)
For instance, R[N2] is just the polynomial ring R[x, y], R[Z2] is the Laurent polynomial ring
R[x±1, y±1], and so on. If R is a complete DVRwith local parameter t, and if R[S] is a finitely
generated R-algebra,we denote its t-adic completion by R〈S〉 and itsweak completion by
R〈S〉†; see [44] (or [25] or [10]) for the definition. Finally, if K is a field, K denotes a fixed
algebraic closure.
When dealing with cones or polytopes in R2,wewill often implicitly assume that
they are of full dimension, that is, they are not contained in a line. However, this will
always be clear from the context. If there is possible doubt, the condition will be stated
explicitly.
2 Nondegenerate curves
Let K be an arbitrary field and denote with T2
K
= SpecK[Z2] the two-dimensional alge-
braic torus over K. Consider
f(x, y) =
∑
(i,j)∈S
fi,jx
iyj ∈ K[Z2] (2.1)
with S a finite subset of Z2 and fi,j ∈ K \ {0} for all (i, j) ∈ S. The set S is called the sup-
port of f. Denote by Γ = Γ(f) the convex hull in R2 of the points (i, j) ∈ S, it is called the
Newton polytope of f. The boundary of Γ is denoted by ∂Γ . The faces of Γ can be sub-
divided according to their dimension: vertices, edges, and Γ itself. Let γ be an edge be-
tween the integral points (a, b) and (c, d), then the arithmetic length l(γ) is defined as
l(γ) = gcd(a − c, b − d) ∈ N \ {0}. Note that the number of integral points on γ is equal to
l(γ) + 1.
Definition 2.1. Let f(x, y) =
∑
(i,j)∈S fi,jx
iyj ∈ K[Z2] be a Laurent polynomial with Newton
polytope Γ . For each face γ of Γ , define fγ(x, y) =
∑
(i,j)∈γ∩Z2 fi,jx
iyj. Then f is called non-
degenerate with respect to its Newton polytope if for all faces γ, the system of equations
fγ = x
∂fγ
∂x
= y
∂fγ
∂y
= 0 (2.2)
has no solutions in the torus T2
K
(i.e., there are no solutions in (K \ {0})2).
Computing Zeta Functions of Nondegenerate Curves 5
Before recalling the geometricmeaning of this notion,we prove that a suﬃciently
generic Laurent polynomial with given Newton polytope will be nondegenerate. This is
well known in the characteristic 0 case.
Lemma 2.2. Let Γ ⊂ R2 be the convex hull of a set of points in Z2. Consider the map
ϕ : Z2 −→ A2
K
: (i, j) −→ (i, j). (2.3)
Then the dimension of the aﬃne subspace of A2
K
spanned by ϕ(Γ ∩ Z2) equals dim Γ . 
Proof. This is not entirely trivial if K is of characteristic p = 0. As the dim Γ = 0 case is
obvious, we first suppose that dim Γ = 1. Take points q1 = q2 ∈ Γ ∩ Z2 and suppose that
ϕ(q1) = ϕ(q2). Then we must have that q2 = q1 + pev for some e ∈ N0 and some nonzero
v ∈ Z2 that is not divisible by p. Because Γ is convex, it also contains q1 +v, and definitely
ϕ(q1) = ϕ(q1 + v).
Now suppose dim Γ = 2. Take points q1, q2 ∈ Γ ∩Z2 such thatϕ(q1) = ϕ(q2). Take
a q3 ∈ Γ ∩Z2 that is not in the span of q1 and q2, but supposeϕ(q3) is in the span ofϕ(q1)
and ϕ(q2), say
q3 = q1 + k
(
q2 − q1
)
+ pev (2.4)
for some e ∈ N0 and some nonzero v ∈ Z2 that is not divisible by p and linearly inde-
pendent of q2 − q1. Note that although this expansion is far from unique, there is a nat-
ural upper bound for e, so that we may assume that it is maximal. Indeed, if we write
q3 −q1 = (a1, a2) and q2 −q1 = (b1, b2), then it is not hard to see that pe | b2a1 −a2b1 = 0.
As a consequence, ϕ(v) and ϕ(q2 − q1) are linearly independent, since otherwise this
would contradict the maximality of e.
Next,wemay suppose that 0 ≤ k < pe by repeatedly replacing pev ← pev±pe(q2−
q1) if necessary. We may even suppose that k = 0, since otherwise we can proceed as in
the dim Γ = 1 case. Now define
q =
k − 1
pe
q1 +
pe − k
pe
q2 +
1
pe
q3 = q2 + v. (2.5)
The first equality shows that q ∈ Γ , the second one shows that q ∈ Z2. Finally,ϕ(q) is not
in the span of ϕ(q1) and ϕ(q2). 
Proposition 2.3. Let Γ be a convex polytope in R2 with integral vertex coordinates and
write S = Γ ∩ Z2. Then the set of points
(
fi,j
)
(i,j)∈S ∈ A
#S
K
(2.6)
6 W. Castryck et al.
for which f =
∑
fi,jx
iyj is not nondegenerate with respect to its Newton polytope is con-
tained in an algebraic set of codimension≥ 1. Moreover, this algebraic set is defined over
the prime subfield of K. 
Proof. Let γ be a face of Γ . Suppose for now that it is two-dimensional. Let Xγ be the
algebraic set in A#S
K
× (AK \ {0})2 defined by the equations
∑
(i,j)∈γ∩Z2
fi,jx
iyj = 0,
∑
(i,j)∈γ∩Z2
ifi,jx
iyj = 0,
∑
(i,j)∈γ∩Z2
jfi,jx
iyj = 0. (2.7)
It has codimension 3. Indeed, for every a, b ∈ K \ {0} the above equations define a linear
codimension 3 subspace of A#S
K
× {x = a, y = b}. Here we used that there is no (a, b, c) ∈
K
3 \ {(0, 0, 0)} such that a+bi+ cj = 0 for all (i, j) ∈ ϕ(γ∩Z2),whereϕ is the map from the
foregoing lemma. Let Yγ be the projection of Xγ on A
#S
K
. It has codimension at least 1 and
consists exactly of those (fi,j)(i,j)∈S that correspond to a Laurent polynomial for which
the nondegenerateness condition with respect to γ is not satisfied.
If γ has dimension < 2, one can again construct such a Yγ using an appropriate
change of variables, so that fγ becomes a univariate Laurent polynomial, or a constant.
Then the Zariski closure of ∪γYγ is the requested algebraic set. Remark that ∪γYγ
may contain points that correspond to Laurent polynomials that are nondegenerate with
respect to their Newton polytope: thiswill be the casewhenever they have aNewton poly-
tope that lies strictly inside Γ . 
Corollary 2.4. Let Γ be a convex polytope in R2 with integral vertex coordinates and let
p be a prime number. Let Pn be the probability that a randomly chosen f ∈ Fpn [Z2] with
support inside Γ is nondegenerate with respect to its Newton polytope. Then Pn → 1 as
n → ∞. 
Note that Proposition 2.3 is false if the condition of Γ being convex is omitted:
S = {(0, 0), (p, 0), (0, p)} is an easy counterexample (where p > 0 is the field characteris-
tic). Another important remark is that Proposition 2.3 cannot be generalized to higher
dimensions. For instance, any trivariate polynomial having
Γ = Conv
{
(0, 0, 0), (1, 0, 0), (0, 1, 0), (1, 1, p)
}
(2.8)
as its Newton polytope (where p > 0 is again the field characteristic)will have a singular
point in the three-dimensional algebraic torus.
Computing Zeta Functions of Nondegenerate Curves 7
Clearly,when f is nondegenerate with respect to its Newton polytope, then f(x, y)
= 0 defines a nonsingular curve on the torus T2
K
(at least if dim Γ = 2). But nondegener-
ateness is much stronger: it implies that there exists a natural compactification XΓ of T2K
in which the closure of this curve is still nonsingular.
2.1 Toric resolution
The construction of XΓ is based on the theory of toric varieties. We refer to [8] for the
general theory. For the convenience of the reader, we will explain the needed material in
a self-contained way.
To any cone Δ ⊂ R2, that is, the set of linear combinations with nonnegative real
coeﬃcients of a finite number of vectors in Q2,we associate the aﬃne toric surface XΔ =
SpecK[Δ].
Let Γ be a polytope in R2, then we can associate a toric surface XΓ to Γ in the
following way: to each face γ, associate the cone Δ(γ) generated by all vectors in
{
x − p | x ∈ Γ, p ∈ γ}. (2.9)
LetUγ be the aﬃne toric surface XΔ(γ). If γ ⊂ τwith τ another face of Γ , then Δ(γ) ⊂ Δ(τ)
and K[Δ(τ)] is obtained from K[Δ(γ)] by adjoining the inverse of each monomial xiyj ∈
K[Δ(γ)] for which (i, j) ∈ Lin(τ). Here Lin(τ) is the linear subspace of R2 generated by the
diﬀerences of vectors in τ. Thus, SpecK[Δ(τ)] is obtained from SpecK[Δ(γ)] by cutting
away some zero locus. Otherwise said: Uτ is canonically embedded in Uγ as a Zariski-
open subvariety. Note thatUΓ = T2K, so T
2
K
is canonically an open subvariety of each vari-
ety Uγ. The surface XΓ is then covered by the aﬃne toric surfaces Uγ, where γ runs over
all vertices of Γ . Two such surfaces Uγ1 and Uγ2 are glued together along their common
open subvariety Uτ with τ the smallest face of Γ containing both γ1 and γ2. The surface
XΓ is complete and normal. Note that the toric surface associated to (anymultiple of) the
standard 2-simplex is just the projective plane P2
K
.
To every face γ we can associate the algebraic torus Tγ = SpecK[Lin(γ)]. Since
Lin(γ) ⊂ Δ(γ),we obtain a surjective homomorphism from K[Δ(γ)] to K[Lin(γ)], by map-
ping the monomials xiyj with (i, j) ∈ Δ(γ) \ Lin(γ) to zero and the other monomials
to themselves. This canonically identifies Tγ with a closed subvariety of Uγ. Note that
dim Tγ = dimγ and that XΓ is the disjoint union of the algebraic tori Tγ, with γ running
over all faces of Γ . Furthermore, the closure of Tγ in XΓ is the disjoint union of all the
Tτ with τ a face of γ. Although XΓ may have singularities, it is smooth outside the zero-
dimensional locus associated to the vertices of Γ .
8 W. Castryck et al.
Now, let f(x, y) ∈ K[Z2] be a Laurent polynomial and let Γ be its Newton polytope.
Let V(f) denote the closure in XΓ of the locus of f in the torus T2K, then V(f) is called the
toric resolution of the aﬃne curve defined by f(x, y) = 0 on T2
K
. Restricting V(f) to Uγ, it
is easy to verify that V(f) ∩ Tγ equals the locus of x−iy−jfγ in Tγ, where (i, j) ∈ γ ∩ Z2. A
standard calculation then shows that V(f) intersects the torus Tγ transversally and does
not contain Tτ for any vertex τ of γ if fγ, ∂fγ/∂x, and ∂fγ/∂y have no common zero in T2K.
In conclusion, the toric compactification XΓ of T2K can be written as the disjoint
union
XΓ = T
2
K
∪ T1 ∪ · · · ∪ Tr ∪ P1 ∪ · · · ∪ Pr (2.10)
with r the number of edges (and thus also the number of vertices) of Γ , Tk the one-dimen-
sional torus associated to the kth edge, and Pk the zero-dimensional torus associated to
the kth vertex. If f is nondegenerate with respect to its Newton polytope Γ , then V(f) is a
complete nonsingular curve on XΓ that does not contain Pk for k = 1, . . . , r and intersects
the tori Tk transversally for all k.
2.2 Riemann-Roch and the Newton polytope
Most results in this section are easy consequences of known more general theorems [7].
For the convenience of the reader we will give a self-contained exposition. Throughout,
assume that K is perfect. Let f ∈ K[Z2] be nondegenerate with respect to its Newton poly-
tope Γ and let C = V(f) ⊂ XΓ be the toric resolution of the curve defined by f on T2K. Enu-
merate the vertices p1, . . . , pr clockwise and let tk be the edge connecting pk with pk+1
(where pr+1 = p1). Let Pk ⊂ XΓ be the zero-dimensional torus corresponding to pk, and
let Tk ⊂ XΓ be the one-dimensional torus corresponding to tk.
For each tk, denote with ek the vector (ak, bk) ∈ Z2 with gcd(ak, bk) = 1 which is
perpendicular to tk and points from tk towards the interior of Γ . DefineNk = pk · ek. Note
that instead of pk we could have taken any vertex on tk, since the diﬀerence is perpendic-
ular to ek.
Define the divisors DC,Γ andWC as
DC,Γ = −
∑
k=1,...,r
Nk
(
Tk ∩ C
)
, WC =
∑
k=1,...,r
(
Tk ∩ C
)
. (2.11)
The notation DC,Γ emphasizes that this divisor depends not only on C, but also on Γ .
Indeed, if we replace f by xiyjf, then Γ is replaced by Γ + (i, j), but C remains the same.
Since from the context it will always be clear what Γ is,we will mostly write DC instead
ofDC,Γ .
Computing Zeta Functions of Nondegenerate Curves 9
For any subsetA ⊂ R2, denote with LA the K-vector space generated by xiyj with
(i, j) ∈ A ∩ Z2. IfD is a divisor on Cwhich is defined over K, then L(D) denotes the corre-
sponding Riemann-Roch space
{
f ∈ K(C) \ {0} | (f) + D ≥ 0} ∪ {0}. (2.12)
Note thatDC,Γ andWC are defined over K. If K ⊂ K ′ is a field extension,we write
LK ′(D) =
{
f ∈ K ′(C) \ {0} | (f) + D ≥ 0} ∪ {0}. (2.13)
Note that L
K
(D) is generated by L(D) because K is perfect. In particular, we have that
dimK L(D) = dimK LK(D).
We will often abuse notation and write things as LA ⊂ L(D), though the latter is
defined as a subspace of the function field K(C).
Lemma 2.5. Let g be a Laurent polynomial with support inmΓ for somem ∈ N0. Let P be
a point in C \ T2
K
and denote with tk the edge of Γ such that P ∈ Tk. Then,
(1) ordP(g) ≥ −ordP(mDC);
(2) if gmtk = ftk = 0 has no solutions in T
2
K
, then equality holds. Conversely, if
equality holds for all P ∈ Tk, then gmtk = ftk = 0 has no solutions in T2K.

Proof. Let pk + α be the integral point on tk that is closest (but not equal) to pk. Let
ek = (ak, bk) be as above, then α = (−bk, ak). Choose a vector β = (c, d) such that
det
(
−bk ak
c d
)
= −1. (2.14)
Note that the cone Δ(tk) is generated by α, −α, β, so that Utk = SpecK[x
′, x ′−1, y ′] ∼=
A
2
K
\ A1
K
. Here
x ′ = x−bkyak ,
y ′ = xcyd,
(2.15)
and Tk corresponds to the locus of y ′ = 0minus the origin. SinceC intersects Tk transver-
sally,we have that y ′ is a local parameter for C at P. Also note that x ′ is a unit in the local
ring at P. The inverse transformation is given by
x = x ′−dy ′ak ,
y = x ′cy ′bk ,
(2.16)
10 W. Castryck et al.
so that, using the notation e ′k = (−d, c),
xiyj = x ′e
′
k·(i,j)y ′ek·(i,j). (2.17)
Now if (i, j) ∈ mΓ , then ek · (i, j) ≥ m(ek ·pk) with equality if and only if (i, j) ∈ mtk. Hence
g(x, y) = y ′m(ek·pk)
(
gmtk
(
x ′−d, x ′c
)
+ y ′(· · · )). (2.18)
Since ek · pk = − ordP DC, the assertions follow. Indeed, ftk(x ′−d, x ′c) vanishes at P, be-
cause (2.18) also holds for g replaced by f and m = 1. 
Corollary 2.6. (1) For i, j ∈ Z, the following holds:
Div
C
(
xiyj
)
=
∑
k=1,...,r
(i, j) · ek
(
Tk ∩ C
)
, (2.19)
which implies that LmΓ ⊂ L(mDC) for anym ∈ N0.
(2) The arithmetic length l(tk) equals #(Tk ∩ C). 
Proof. The first statement follows immediately from (2.17) and the inequality on the line
below it. The second statement follows from the last assertion in the above proof, namely,
that the points of Tk ∩ C correspond to the zeros of ftk(x ′−d, x ′c). Now the latter can be
written as a power of x ′ times a degree l(tk) polynomial in x ′ with nonzero constant term
and without multiple roots. 
Corollary 2.7. Let fy denote the partial derivative of fwith respect to y, then
Div
C
(
dx
xyfy
)
= DC − WC. (2.20)
In particular, the diﬀerential form dx/(xyfy) has no poles, nor zeros on C ∩ T2K. 
Proof. First, let P be a point of C \ T2
K
. We have to prove that
ord
P
dx
xyfy
= ord
P
DC − 1. (2.21)
With the notation as in Lemma 2.5, we have that ftk(x
′−d(P), x ′c(P)) = 0, where k is such
that P ∈ Tk. Thus, because of the nondegenerateness of f,
(
x
∂ftk
∂x
)
(
x ′−d(P), x ′c(P)
) = 0 or
(
y
∂ftk
∂y
)
(
x ′−d(P), x ′c(P)
) = 0. (2.22)
Computing Zeta Functions of Nondegenerate Curves 11
We may suppose that the second condition holds. Indeed, the first case is treated anal-
ogously using that dx/xyfy = −dy/xyfx. Moreover, ordP x is not a multiple of the char-
acteristic p of K. Indeed if it was, then from formulas (2.16) and the material above it,
ak ≡ 0modp and α ≡ (−bk, 0)modp (if p = 0, these congruences become exact equali-
ties). Hence ftk has a special form: it equals a monomial with exponent pk times a Lau-
rent polynomial with all exponents of y divisible by p. This Laurent polynomial vanishes
on (x ′−d(P), x ′c(P)), because x ′ is a unit at P. But this contradicts the assumed second
condition on ∂ftk/∂y.
Now apply Lemma 2.5 (and its proof)with g replaced by yfy to find that ordP yfy
= − ordP(DC). Since ordP x is not divisible by p, we have ordP dx/x = −1 and the result
follows.
Next, take P ∈ C ∩ T2
K
. Write P = (px, py). Because of the nondegenerateness, we
have that (∂f/∂x)(P) = 0 or (∂f/∂y)(P) = 0. In particular, dx/xyfy = −dy/xyfx can have no
pole at P. For the same reason, x − px or y − py must be local parameters at P so that for
instance dx/xyfy = d(x − px)/xyfy can have no zero at P. 
As a consequence, DC − WC is a canonical divisor. This observation allows us to
give an elementary proof of a well-known result; see [20] formuchmore general theorems
on this matter.
Corollary 2.8. (1) 2g − 2 = degDC − degWC with g the genus of C.
(2) g = #((Γ \ ∂Γ) ∩ Z2), that is, the genus of C is the number of interior lattice
points in Γ . 
Proof. (1) From the Riemann-Roch theorem, it follows that the degree of a canonical di-
visor is 2g − 2.
(2) Because of Pick’s theorem [19],which states that
Vol(Γ) = #
(
(Γ \ ∂Γ) ∩ Z2) + #
(
∂Γ ∩ Z2)
2
− 1, (2.23)
it suﬃces to prove that degDC = 2Vol(Γ). For every edge tk, consider the triangle Δk
defined by the two vertices of tk and the origin. If the origin happens to be one of the
vertices, this is just a line segment. Then
Vol(Γ) =
∑
k
− sgn
(
Nk
)
Vol
(
Δk
)
. (2.24)
NowΔk is a triangle with base l(tk)‖ek‖ (the length of tk) and height |pk ·ek|/‖ek‖, so that
its volume equals l(tk)|Nk|/2. The result follows. 
12 W. Castryck et al.
We note that the inequality g ≤ #((Γ \∂Γ)∩Z2) holds in any case, that is,without
the nondegenerateness condition. This is Baker’s formula: over C it was known already
in 1893, a proof of the general case can be found in [3].
We conclude this section with the following theorem, which is an easy conse-
quence of the fact that Hi(XΓ ,E) = 0 for any i ≥ 1 and any invertible sheaf E on XΓ which
is generated by its global sections (see [8, Corollary 7.3 and Proposition 6.7]). But for the
convenience of the reader we will give a more elementary proof.
Theorem 2.9. For anym ∈ N0, the Riemann-Roch space L(mDC) is equal to LmΓ . 
Proof. For our proof, the abuse of notation mentioned at the beginning of this section is
somewhat annoying. Therefore, we will temporarily introduce the notation Am, which
denotes the image of LmΓ inside the function field K(C). Note that the actual statement
of the theorem should then be L(mDC) = Am.
We already showed that Am ⊂ L(mDC). Therefore, it suﬃces to prove that the
dimensions are equal. From Corollary 2.8 and the Riemann-Roch theorem, we have that
dimL(mDC) = mdegDC + 1− g. Note that this is a polynomial of degree 1 inm ≥ 1. Now
consider the maps
rm : L(m−1)Γ −→ LmΓ : w −→ wf, m ≥ 1. (2.25)
We claim that coker rm ∼= Am. Indeed,we will show that the natural map
coker rm −→ Am (2.26)
is injective. Let v ∈ LmΓ be such that v = 0 in the function field. Then there exists a unique
Laurent polynomial q such that v = fq. Now for any k = 1, . . . , r,we have
ord
Tk
v = ord
Tk
f + ord
Tk
q. (2.27)
Here, ordTk is the valuation at Tk in XΓ (which is nonsingular in codimension one). From
formula (2.18), one deduces that ordTk v ≥ mNk (indeed, y ′ is a local parameter at Tk).
Similarly, we have ordTk f = Nk. Therefore, ordTk q ≥ (m − 1)Nk. By a similar argument,
now using (2.17), we conclude that q ∈ L(m−1)Γ , which proves the claim. Now by a well-
known result by Ehrhart [14], dimLmΓ is a quadratic polynomial in m with leading coef-
ficient Vol(Γ) form ≥ 0. As a consequence,
dimAm = dimcoker rm = dimLmΓ − dimL(m−1)Γ (2.28)
Computing Zeta Functions of Nondegenerate Curves 13
is just like dimL(mDC) a linear polynomial inm form ≥ 1. Therefore, it suﬃces to prove
equality form = 1 andm → ∞.
The case m = 1 follows from Corollary 2.8. Indeed,
dimL
(
DC
)
= degDC + 1 − g = 2g − 2 + #
(
∂Γ ∩ Z2) + 1 − g = #(Γ ∩ Z2) − 1,
(2.29)
which is precisely dimA1.
For the case m → ∞, it suﬃces to prove that
degDC = lim
m→∞
dimLmΓ − dimL(m−1)Γ
m
. (2.30)
Since dimLmΓ = Vol(Γ)m2 + · · · , the right-hand side is 2Vol(Γ) which is indeed
2#
(
Γ \ ∂Γ ∩ Z2) + (∂Γ ∩ Z2) − 2 = 2g − 2 + degWC, (2.31)
according to Pick’s theorem [19]. 
2.3 Eﬀective Nullstellensatz
In this section,we prove a new sparse eﬀective Nullstellensatz. Because this is interest-
ing in its own right, things are treated somewhat more generally than is needed for the
rest of the paper. Let K be a field or a discrete valuation ring with maximal ideal m. Let
f ∈ K[Zn] := K[x±11 , . . . , x±1n ] define a smooth aﬃne scheme over K. Then there exist Lau-
rent polynomials α,β1, . . . , βn ∈ K[Zn] for which
1 = αf + β1x1
∂f
∂x1
+ · · · + βnxn ∂f
∂xn
. (2.32)
Though this is well known, we give the following inductive argument for the DVR case
(using the field case), for use in the proof of Lemma 2.17. Let t be a local parameter of K.
Since f is a smooth aﬃne scheme over K, there exist Laurent polynomials α,β1, . . . , βn ∈
Frac(K)[Zn] and α˜1, ˜β1, . . . , ˜βn ∈ K[Zn] such that
1 = αf + β1x1
∂f
∂x1
+ · · · + βnxn ∂f
∂xn
, (2.33)
1 ≡ α˜f + ˜β1x1 ∂f
∂x1
+ · · · + ˜βnxn ∂f
∂xn
mod t. (2.34)
14 W. Castryck et al.
Clearing denominators in (2.33) yields
tm = α ′f + β ′1x1
∂f
∂x1
+ · · · + β ′nxn
∂f
∂xn
(2.35)
for some m ∈ N and α ′, β ′1, . . . , β ′n ∈ K[Zn]. If m = 0,we are done. If not,we can reduce m
inductively by rewriting (2.34) as 1+tQ = α˜f+˜β1x1(∂f/∂x1)+ · · ·+˜βnxn(∂f/∂xn) for some
Q ∈ K[Zn]. Now multiply this equation with tm−1, multiply (2.35) with Q, and subtract.
This concludes the proof.
Next, for the sake of being self-contained,we give the following definitions; they
are straightforward generalizations of the corresponding notions defined in a previous
section.
Definition 2.10. The Newton polytope Γ(h) of a polynomial h ∈ K[Zn] is the polytope in
R
n obtained by taking the convex hull of the support of h, that is, the set of exponent
vectors in Zn corresponding to monomials that have a nonzero coeﬃcient in h.
For any σ ⊂ Rn, we denote by hσ the Laurent polynomial obtained from h by
setting all monomials whose exponent vectors lie outside of σ equal to zero.
Definition 2.11. Suppose K is a field and let h ∈ K[Zn]. Let Γ be a convex polytope in Rn
with vertices in Zn and suppose h has support inside Γ . If
hγ = x1
∂hγ
∂x1
= x2
∂hγ
∂x2
= · · · = xn ∂hγ
∂xn
= 0 (2.36)
has no solutions in Tn
K
:= (K \ {0})n for all faces γ of Γ (including Γ itself), then it is said
that h is nondegenerate with respect to Γ .
Now, for reasons that will become clear in Section 4, we want the Newton poly-
topes of α,β1, . . . , βn to be as small as possible. It will turn out that a natural bound
exists whenever f, that is, the reduction modulo m, is nondegenerate with respect to Γ(f),
at least if the latter is n-dimensional and contains the origin. The main theorem is the
following sparse eﬀective Nullstellensatz,which seems new even when K = C. Our proof
is inspired by an argument in [29], see also [2, Section 4].
Theorem 2.12. Let K be a field or a DVR, and denote its maximal ideal by m. Let Γ be a
convex polytope in Rn with vertices in Zn and suppose that dim Γ = n. Let f0, f1, . . . , fn ∈
K[Zn] have supports in Γ and take a g ∈ K[Zn] with support in (n + 1)Γ . Suppose that for
every face γ of Γ , the system f0γ = · · · = fnγ = 0 has no solutions in Tn(K/m). Then there
exist h0, . . . , hn ∈ K[Zn] with support in nΓ such that g = h0f0 + · · · + hnfn. 
Computing Zeta Functions of Nondegenerate Curves 15
Proof. Write k = K/m. Let SkΓ be the graded ring consisting of all k-linear combinations
of terms of the form
tdxe, with d ∈ N, e ∈ dΓ ∩ Zn. (2.37)
The degree of such a term is by definition equal to d. Similarly, let SKΓ consist of the K-
linear combinations.
Let Δ be the cone in Rn+1 generated by all vectors (d, e) with d ∈ N and e ∈ dΓ .
Clearly SkΓ = k[Δ]. Because the systems f0γ = · · · = fnγ = 0 have no common solution in
T
n
k , the locus in Spec(S
k
Γ ) of (tf0, . . . , tfn) consists of only one point. This is easily verified
considering the restrictions of the locus of tfi to the tori that partition Spec(SkΓ ). Hence
SkΓ
(
tf0, . . . , tfn
) (2.38)
has Noetherian dimension zero. On the other hand, SkΓ is a Cohen-Macaulay ring by a
well-known result of Hochster (see, e.g., [8, Theorem 3.4]) that states that k[C] is Cohen-
Macaulay for any cone C. So tf0, . . . , tfn is a regular sequence. This means that we have
exact sequences
0 −→
(
SkΓ
(
tf0, . . . , tfi
)
)
d−1
−→
(
SkΓ
(
tf0, . . . , tfi
)
)
d
−→
(
SkΓ
(
tf0, . . . , tfi+1
)
)
d
−→ 0,
(2.39)
where the second arrow is multiplication by tfi+1, and where (· · · )d denotes the homoge-
neous part of degree d. Thus
dim
k
(
SkΓ
(
tf0, . . . , tfi+1
)
)
d
= dim
k
(
SkΓ
(
tf0, . . . , tfi
)
)
d
− dim
k
(
SkΓ
(
tf0, . . . , tfi
)
)
d−1
.
(2.40)
By a result of Ehrhart [14], the number of lattice points in dΓ (which is precisely
dimk(SΓ )d) is a polynomial function in d for all d ≥ 0. We obtain that
dim
k
(
SkΓ
(
tf0, . . . , tfn
)
)
d
(2.41)
is a polynomial function in d for all d ≥ n + 1. Since the Noetherian dimension is zero,
this polynomial must be zero as well.
16 W. Castryck et al.
In particular,we have that the k-linear map
Wk :
n
⊕
i=0
(
SkΓ
)
n
−→ (SkΓ
)
n+1
:
(
tnh0, . . . , t
nhn
) −→ tn+1(h0f0 + · · · + hnfn
)
(2.42)
is surjective. But then necessarily the corresponding K-map
WK :
n
⊕
i=0
(
SKΓ
)
n
−→ (SKΓ
)
n+1
:
(
tnh0, . . . , t
nhn
) −→ tn+1(h0f0 + · · · + hnfn
)
(2.43)
is surjective. Indeed, letM be thematrix ofWK. Then its reductionmodulom is thematrix
ofWk, so it has aminor ofmaximal dimensionwith nonzero determinant. But thismeans
thatM itself has a minor of maximal dimension whose determinant is a unit in K. 
The following corollary will be essential in devising a sharp bound for the rate of
overconvergence of a lift of the Frobenius endomorphism in Section 4. It will also allow
us to translate the action of Frobenius on the firstMonsky-Washnitzer cohomology space
(consisting of diﬀerential forms) to a space of functions that will be introduced in the
next section. The exact way in which this is done is described in Steps 2 and 6 of the
algorithm (Section 7).
Corollary 2.13. Let K be a field or a DVR and denote by k its residue field. Let f ∈ K[Zn]
and suppose that f and its reduction f ∈ k[Zn] have the same Newton polytope Γ , which
is supposed to be n-dimensional and to contain the origin. If f is nondegenerate with
respect to its Newton polytope, then there exist α,β1, . . . , βn ∈ K[Zn] such that
1 = αf + β1x1
∂f
∂x1
+ · · · + βnxn ∂f
∂xn
(2.44)
with Γ(α), Γ(β1), . . . , Γ(βn) ⊂ nΓ(f). 
Proof. Apply Theorem 2.12 to f, x1(∂f/∂x1), . . . , xn(∂f/∂xn). 
A second corollary to Theorem 2.12 is that an arbitrary lift of a nondegenerate
Laurent polynomial with the same Newton polytope is again nondegenerate.
Corollary 2.14. Let K be a DVR with residue field k and let f ∈ K[Zn]. Suppose f and its
reduction f have the sameNewton polytope. If f is nondegeneratewith respect to its New-
ton polytope, then so is f (when considered over the fraction field of K). 
Computing Zeta Functions of Nondegenerate Curves 17
Proof. Let Γ = Γ(f) = Γ(f). Let γ be any face of Γ . If f is nondegenerate with respect to Γ ,
then so is fγ with respect to γ. Using an appropriate change of variables, we can apply
Theorem 2.12 to find a Laurent monomial xr11 · · · xrnn and Laurent polynomials g0, g1, . . . ,
gn ∈ K[Zn] such that
xr11 · · · xrnn = g0fγ + g1
∂fγ
∂x1
+ · · · + gn ∂fγ
∂xn
. (2.45)
In particular, fγ = x1(∂fγ/∂x1) = · · · = xn(∂fγ/∂xn) = 0 can have no solutions in TnFrac(K).

We conclude this section with a discussion on what can happen if our Laurent
polynomial is not nondegenerate with respect to its Newton polytope. In that case,much
worse bounds than the one given in Corollary 2.13 need to be used. We restrict our ex-
amples to the bivariate polynomial case, that is, f ∈ K[x, y]. If K is a field, a quadratic
upper bound follows from general eﬀective Nullstellensatz theorems, such as [28, Theo-
rem 1.5]. Example 2.15 shows that this bound is asymptotically sharp. If K is a DVR, it is
even impossible to give bounds in terms of Γ(f),which is shown in Example 2.16.
Example 2.15. Let K be a field of finite characteristic p and let d ≥ 2p be a multiple of p.
Consider the degree d + 1 polynomial
f = yd+1 + xd−pyp + 1 (2.46)
(its definition is inspired by [28, Example 2.3]). It defines an irreducible nonsingular
curve in A2
K
, so take polynomials α,β, γ ∈ K[x, y] such that
1 = αf + β
∂f
∂x
+ γ
∂f
∂y
. (2.47)
Let λ be the maximum of the degrees of α, β, γ. Homogenizing the above equation with
respect to a new variable z yields that zλ+d+1 ∈ I. Here, I ⊂ K[x, y, z] is the ideal generated
by the homogenizations of f, ∂f/∂x, ∂f/∂y, that is,
I =
(
xd−pypz + zd+1, yd
)
. (2.48)
Now consider its image˜I under the map
K[x, y, z] −→ K[y, z] : h(x, y, z) −→ h(1, y, z). (2.49)
Then
˜I =
(
ypz + zd+1, yd
)
. (2.50)
18 W. Castryck et al.
It is easy to verify that no power of z less than d2/p can be contained in ˜I, and a fortiori
the same holds for I. Therefore,
λ ≥ d
2
p
− d − 1, (2.51)
which isO((deg f)2).
Example 2.16. Let K be an arbitrary DVR with local parameter t. Consider f = y − txy +
(tm + t2)x2 − 1 ∈ K[x, y] for some big natural number m (its definition is inspired by an
example in [1]). Since the system of equations
f = y − txy +
(
tm + t2
)
x2 − 1 = 0,
∂f
∂x
= −ty + 2
(
tm + t2
)
x = 0,
∂f
∂y
= 1 − tx = 0
(2.52)
has no solutions, neither over K, nor over K/(t), there exist polynomials α,β, γ ∈ K[x, y]
that satisfy
1 = αf + β
∂f
∂x
+ γ
∂f
∂y
. (2.53)
Putting y = 1 + tx and reducing modulo tm gives the following identity in K/(tm)[x]:
1 = α
(
(1 − tx)(1 + tx) + t2x2 − 1
)
+ β
(
− t(1 + tx) + 2t2x
)
+ γ(1 − tx)
= −tβ(1 − tx) + γ(1 − tx) = (γ − tβ)(1 − tx).
(2.54)
Since the inverse of 1 − tx in K/(tm)[x] is 1 + tx + t2x2 + · · · + tm−1xm−1,we conclude that
max {degβ,degγ} ≥ deg(γ − tβ) ≥ m − 1. (2.55)
In fact, the above example shows that even the valuations of the coeﬃcients of
f do not suﬃce to give a Nullstellensatz bound. The best we can do are results of the
following type.
Lemma 2.17. Let K be a DVR with local parameter t. For every d ∈ N \ {0}, there exists a
nonzero polynomial gd ⊂ K[cij]i,j∈N, i+j≤d of degree ≤ 3(d2 + 1)(d2 + 2)/2, for which the
following holds. If
f =
∑
i+j≤d
Cijx
iyj ∈ K[x, y] (2.56)
Computing Zeta Functions of Nondegenerate Curves 19
defines a smooth aﬃne K-scheme, then there are polynomials α,β, γ ∈ K[x, y] such that
1 = αf + β(∂f/∂x) + γ(∂f/∂y) with
degα,degβ,degγ ≤ d2
(
1 + ord
t
gd
(
Cij
)
)
. (2.57)

Proof. Given such an f, we know from [28, Theorem 1.5] that there exist α ′, β ′, γ ′ ∈
Frac(K)[x, y] of degree ≤ d2 for which 1 = α ′f + β ′(∂f/∂x) + γ ′(∂f/∂y). In other words,
the formula
1 =
(
∑
i+j≤d2
α ′ijx
iyj
)
f +
(
∑
i+j≤d2
β ′ijx
iyj
)
∂f
∂x
+
(
∑
i+j≤d2
γ ′ijx
iyj
)
∂f
∂y
(2.58)
gives rise to a system Sf of linear equations in n = 3(d2 + 1)(d2 + 2)/2 unknowns α ′ij, β
′
ij,
γ ′ij that is solvable over Frac(K). Let
r := max
f
rank
(
Sf
) ≤ n, (2.59)
and let f0 =
∑
i+j≤d C0,ijx
iyj be a polynomial for which this rank is actually obtained.
Then Sf0 has a non-zero (r × r)-minor, which is a degree r polynomial expression in the
C0,ij. Let gd(cij) ∈ K[cij] be the corresponding polynomial.
Now, using Cramer’s rule,we can find a solution to Sf0 such that the valuations of
the denominators appearing in this solution are bounded by ordt gd(C0,ij). In fact, this
statement holds in general: for any f =
∑
i+j≤d Cijx
iyj,we can find a solution to Sf whose
denominators are bounded by ordt gd(Cij). Indeed, either gd(Cij) equals zero, or it is a
minor of maximal dimension of Sf. Now using the induction procedure mentioned at the
beginning of this section, and again using [28, Theorem 1.5] (but now over the residue
field),we get the desired result. 
3 Cohomology of nondegenerate curves
Let Fq be a finite field with q = pn, p prime. Given a Laurent polynomial f ∈ Fq[Z2] that is
nondegenerate with respect to its Newton polytope Γ , let C denote the nonsingular curve
V(f), that is, the closure inXΓ of the zero locus of f in the torusT2Fq . HereXΓ is the toric Fq-
surface associated to Γ . Suppose that C has genus g ≥ 1. Then without loss of generality,
wemay assume that
(1) there are dt > db ∈ Z such that Γ has a unique top vertex (with y-coordinate
dt) and a unique bottom vertex (with y-coordinate db),
20 W. Castryck et al.
(2) the origin is an interior point of Γ
(ct,dt)
Γ
(cb,db)
(3.1)
The two important consequences of this setting are that
(1) the set S := {xkyl | k, l ∈ Z, db ≤ l < dt} is an Fq-basis for Fq[Z2]/(f);
(2) every h ∈ Fq[Z2] has support inmΓ for some big enough m ∈ N.
To see why we may assume that Γ is of the above shape, take vertices vt and vb such that
‖vt − vb‖ is maximal. Take α ∈ Z2 with coprime coordinates such that it is perpendicular
to vt−vb. Let β ∈ Z2 be such that α = (α1, α2), β = (β1, β2) generate Z2 over Z. There exist
(γ1, γ2), (δ1, δ2) ∈ Z2 such that
(
α1 α2
β1 β2
)(
γ1 γ2
δ1 δ2
)
= I. (3.2)
Then the isomorphism x ← xγ1yγ2 , y ← xδ1yδ2 yields unique top and bottom vertices of
the Newton polytope. Moreover, it preserves nondegenerateness. For the second condi-
tion, remember that the number of interior points in Γ equals g ≥ 1. Let (a, b) be an inte-
rior point, then x−ay−bf is nondegenerate with respect to its Newton polytope Γ − (a, b)
and clearly (0, 0) is an interior point of Γ − (a, b).
Let Qq denote the unramified extension of degree n of Qp with valuation ring Zq
and residue field Zq/(pZq) ∼= Fq. Take an arbitrary lift f ∈ Zq[Z2] of f such that Γ(f) =
Γ(f) = Γ . Note that we have properties similar to the ones mentioned above:
(1) the set S := {xkyl | k, l ∈ Z, db ≤ l < dt} is a Zq-module basis for Zq[Z2]/(f);
(2) every h ∈ Zq[Z2] has support inmΓ for some big enoughm ∈ N.
Due to Corollary 2.14, f is also nondegenerate with respect to its Newton polytope (when
considered over Qq). As a consequence, if C denotes the nonsingular curve obtained by
taking the closure inXΓ (the toricQq-surface associated to Γ) of the zero locus of f inT2Qq ,
we have that g(C) = g(C). Also, for each edge γ of Γ ,we have
#
(
C ∩ Tγ
)
= #
(
C ∩ Tγ
)
, (3.3)
Computing Zeta Functions of Nondegenerate Curves 21
where Tγ (resp., Tγ) is the algebraic torus associated to γ over Qq (resp., over Fq) and
the intersections are transversal. These and other observations reveal a deep geometric
correspondence between C and C that is directed by the Newton polytope. This is the
main reason why we work with nondegenerate curves. Indeed, as in Kedlaya’s algorithm
it enables us to compute in the algebraic de Rham cohomology of C. Namely,we have the
following very general theorem [26, Theorem 1].
Theorem 3.1. Let Y be a smooth proper Zq-scheme, let Z ⊂ Y be a relative normal cross-
ings divisor and let X = Y \ Z. If X is aﬃne, then for any i ∈ N there exists a canonical
isomorphism
HiDR
(
X
⊗
Zq
Qq
)
−→ HiMW
(
X
⊗
Zq
Fq/Qq
)
, (3.4)
whereHiDR denotes algebraic de Rham cohomology andH
i
MW denotes Monsky-Washnit-
zer cohomology. 
The above theorem applies in our situation with X = Spec(Zq[Z2]/(f)) and Y its
closure in the toric scheme associated to Γ (this is constructed exactly as in Section 2.1,
with K replaced by Zq). This is a smooth proper scheme and by the above observations
Z = Y \ X is indeed a relative normal crossings divisor.
An alternative proof of Theorem 3.1 (in the case of a nondegenerate curve) fol-
lows from the material in Section 5. There we will implicitly prove that the canonical
map (3.4) with i = 1 is surjective. Since both Z
⊗
Zq
Fq and Z
⊗
Zq
Qq contain #(∂Γ ∩ Z2)
points, we have that the dimensions are equal, which shows that the map is an isomor-
phism:
dimH1DR
(
X
⊗
Zq
Qq
)
= dimH1MW
(
X
⊗
Zq
Fq/Qq
)
= 2g + #
(
∂Γ ∩ Z2) − 1 = 2Vol(Γ) + 1.
(3.5)
The last equality follows from Pick’s theorem [19] and Corollary 2.8. This relationship
between Vol(Γ) and the Betti numbers of X
⊗
Zq
Qq was already noticed in a much more
general setting by Hovanskiı˘ [20].
As a first step towards constructing a basis forH1DR(X
⊗
Zq
Qq),we prove the fol-
lowing theorem. Let A = Zq[Z2]/(f), denote by D1(A) the universal Zq-module of diﬀer-
entials of A, and by d : A → D1(A) the corresponding exterior derivation. Thus H1DR(C ∩
T
2
Qq
) = (D1(A)/d(A))
⊗
Zq
Qq.
22 W. Castryck et al.
Theorem 3.2. Every element of D1(A)
⊗
Zq
Qq is equivalent modulo d(A)
⊗
Zq
Qq with a
diﬀerential form ωwith divisor
Div
C
(ω) ≥ −DC − WC. (3.6)

Proof. First, suppose that all places Pk ∈ C\T2Qq areQq-rational.WriteDC =
∑r
k=1 akPk.
Since the origin is an interior point of Γ , all ak > 0. Note thatDC + WC =
∑r
k=1(ak + 1)Pk
and that degDC =
∑r
k=1 ak > 2g−2due to Corollary 2.8. Now letω
′ ∈ D1(A)⊗
Zq
Qq have
a pole of order bk+1 > ak+1 at some place Pk. Because of the Riemann-Roch theorem,we
can find a function h ∈ L(a1P1+· · ·+bkPk+· · ·+arPr)\L(a1P1+· · ·+(bk−1)Pk+· · ·+arPr).
Then adding to ω ′ a suitable multiple of dh will reduce the pole order at Pk. Continuing
in this way eventually proves the theorem in case all Pk are Qq-rational.
The general case follows easily from the above, using thatDC andWC are defined
over Qq. 
In the above proof, we reduced the pole orders one place at a time for simplicity.
However, in the algorithm the reduction will proceed more simultaneously by moving
from “level” mDC + WC to “level” (m − 1)DC + WC. Indeed, because of Theorem 2.9 we
have a good understanding of what the spaces L(mDC) look like. For the same reason, it
is more natural to work with functions instead of diﬀerential forms.
Consider the following map:
Λ : A
⊗
Zq
Qq −→ D1(A)
⊗
Zq
Qq : h −→ h dx
xyfy
. (3.7)
Let α,β ∈ A be such that 1 = αfx + βfy. Then dx/fy = βdx − αdy, which shows that Λ is
well defined. Moreover, for any g1, g2 ∈ A,we have thatΛ(xy(fyg1 − fxg2)) = g1dx+g2dy,
so that it is in fact a bijection. By Corollary 2.7,we have DivC(Λ(h)) = Div(h) +DC −WC.
Applying Theorem 3.2 shows that each diﬀerential form in D1(A)
⊗
Zq
Qq is equivalent
modulo exact diﬀerential forms with an ω with divisor DivC(ω) ≥ −DC − WC. Take h ∈
A
⊗
Zq
Qq such that Λ(h) = ω, then
Div
C
(
Λ(h)
)
= Div
C
(h) + DC − WC ≥ −DC − WC ⇐⇒ h ∈ L
(
2DC
)
. (3.8)
This shows that Λ(L(2DC)) generates H1DR(C ∩ T2Qq).
To find an actual basis for H1DR(C ∩ T2Qq),we define an operator D on A such that
the image underΛ is an exact diﬀerential, that is, dh = Λ(Dh). The definition ofD follows
Computing Zeta Functions of Nondegenerate Curves 23
easily from the following:
dh = hxdx + hydy = xy
(
fyhx − fxhy
) dx
xyfy
, (3.9)
and thus
D(h) = xy
(
fy
∂
∂x
− fx
∂
∂y
)
(h). (3.10)
By Theorem 2.9 we have the following corollary. A related description, for nonde-
generate hypersurfaces of any dimension, is contained in [2, Corollary 6.10 and Theorem
7.13].
Corollary 3.3. If the origin is an interior point of Γ , then Λ induces an isomorphism of
Qq-vector spaces,
L2Γ
fLΓ + D
(
LΓ
)
∼= H1DR
(
C ∩ T2
Qq
)
. (3.11)

Note that the proof of the above corollary does not provide an explicit bound on the de-
nominators introduced during the reduction, which is required to determine the p-adic
precision up to which one has to compute. In Section 5, we describe a simple reduction
algorithm and at the same time prove tight bounds on the loss of precision.
4 Lifting Frobenius endomorphism
We begin this section by introducing the following notation. Write
A =
Fq[Z2]
(f)
, A =
Zq[Z2]
(f)
, A∞ =
Zq
〈
Z
2
〉
(f)
, A† =
Zq
〈
Z
2
〉†
(f)
, (4.1)
and define the pth and qth power Frobenius endomorphisms
Fp : A −→ A : a −→ ap, Fq : A −→ A : a −→ aq. (4.2)
A main task in developing a point counting algorithm using Monsky-Washnitzer coho-
mology is the computation of a Zp-algebra endomorphism Fp : A† → A† that lifts Fp in
the sense that Fp ◦ π = π ◦ Fp, where π is reduction modulo p. Then Fq := Fp ◦ · · · ◦ Fp
is a Zq-algebra morphism that lifts Fq. Note that decomposing Fq into n copies of Fp (p
small) dramatically improves the running time of the algorithm: this is the main reason
why p-adic point counting algorithms are especially well suited for small values of p.
24 W. Castryck et al.
First,we consider the following Hensel-like lemma. In a paper subsequent to this
one, Kedlaya gives a related result,with a more elegant proof [27].
Lemma 4.1. Let Γ be a convex polygon in R2 with vertices in Z2. Take a, b ∈ N (not both
zero) and letH(Z) =
∑
hkZ
k ∈ Zq[Z2][Z] satisfy
(1) Γ(hk) ⊂ (ak + b)Γ for all k ∈ N;
(2) h0 ≡ 0modp;
(3) h1 ≡ 1modp.
Then there exists a unique solution Z0 =
∑
(i,j)∈Z2 ai,jx
iyj ∈ (p) ⊂ Zq〈Z2〉 to the equation
H(Z) = 0. Moreover, if m ∈ N and (r, s) ∈ Z2 are such that (r, s) /∈ mΓ , then ordp ar,s ≥
m/2(a + b). 
Remark 4.2. Note thatwe implicitly force Γ to contain the origin: this follows from condi-
tions 1 and 3. If Γ = {(0, 0)}, Lemma 4.1 is just Hensel’s lemma overZq. Finally, remark that
if (r, s) is not contained in any multiple of Γ , the above lemma implies that ar,s equals 0.
Proof. The existence and uniqueness of Z0 follow immediately fromHensel’s lemma, ap-
plied over Zq〈Z2〉. Therefore,we only need to prove the convergence bound. Let (r, s) ∈ Z2
and m ∈ N be such that (r, s) /∈ mΓ . Then there exists an edge spanning a line eX + fY =
c(e, f, c ∈ Z), where Γ ⊂ {(i, j) ∈ Z2 | ei + fj ≤ c}, such that er + fs > mc. Using a transfor-
mation of variables of the type used in Lemma 2.5, we may assume that e = 0, f = 1, and
c ≥ 0. Thus s > mc.
Now, replace inH(Z) all occurrences of y−1 with a new variable t. We get
Hrepl(Z) =
∑
hk,repl(x, y, t)Zk ∈ Zq
[
x±1, y, t
]
[Z] (4.3)
with degy hk,repl ≤ (ak + b)c. Note that the conditions for Hensel’s lemma are still satis-
fied. So there exists a unique
Z0,repl =
∑
(i,j,k)∈Z×N2
bi,j,kx
iyjtk ∈ (p) ⊂ Zq
〈
x±1, y, t
〉
(4.4)
satisfying Hrepl(Z0,repl) = 0. If we substitute y−1 for t, we get precisely Z0, due to the
uniqueness statement in Hensel’s lemma. Henceforth,
ar,s =
∑
j−k=s
br,j,k. (4.5)
Let K be a suitably ramified extension of Qq and denote by R its valuation ring. Consider
H ′repl(Z
′) =
∑
pμ2(k−1)hk
(
x, p−μ1y ′, t
)
Z ′k ∈ K[x±1, y ′, t][Z ′] (4.6)
Computing Zeta Functions of Nondegenerate Curves 25
obtained from Hrepl(Z) by substituting y ← p−μ1y ′, Z ← pμ2Z ′ and multiplying every-
thing with p−μ2 . Here μ1, μ2 are positive rational numbers to be determined later. We
know that if
μ2 + jμ1 < 1 ∀j ≤ bc,
jμ1 < 1 ∀j ≤ (a + b)c,
(k − 1)μ2 ≥ jμ1 ∀j ≤ (ak + b)c
(4.7)
for k = 2, . . . ,degH, then H ′repl has integral coeﬃcients and H
′
repl(0) ≡ 0 and (dH ′repl/
dZ ′)(0) ≡ 1modP. Here P is the maximal ideal of R. In that case, Hensel’s lemma implies
that there is a unique Z ′0,repl ∈ P · R〈x±1, y ′, t〉 such thatH ′repl(Z ′0,repl) = 0. Write
Z ′0,repl =
∑
(i,j,k)∈Z×N2
b ′i,j,kx
iy ′jtk (4.8)
and perform reverse substitution to obtain that
∑
(i,j,k)∈Z×N2
pμ2pjμ1b ′i,j,kx
iyjtk (4.9)
is a solution to Hrepl(Z) = 0 in P · R〈x±1, y, t〉. Again using the uniqueness statement in
Hensel’s lemma,we conclude that this is precisely Z0,repl. As a consequence,
ord
p
bi,j,k ≥ jμ1 + μ2. (4.10)
Using (4.5) we find that ordp ar,s ≥ sμ1 + μ2 > mcμ1 + μ2. This gives the desired result,
since we can take μ2 = (2(a + b)c − bc)/(2(a + b)c + ε) and μ1 = 1/(2(a + b)c + ε) for any
ε ∈ Q>0. 
We are now ready to describe the construction of Fp. In doing so,wewill system-
atically make a notational distinction between power series g and the cosets [g] (mod-
ulo f) they represent (something which is usually not done in order to simplify notation).
Throughout, the assumptions about Γ made at the beginning of Section 3 should be kept
in mind.2
2In fact, for this section it suﬃces that Γ contains the origin (not necessarily as an interior point).
26 W. Castryck et al.
We will use a technique that was first described in [10]. Suppose we can find a
Z0 ∈ Zq〈Z2〉† and polynomials δx, δy ∈ Zq[Z2] such that
[
fσ
(
xp
(
1 + δxZ0
)
, yp
(
1 + δyZ0
))]
= [0] in A†, (4.11)
where fσ is obtained from f by applying Frobenius substitution3 to the coeﬃcients. Then
Fp : A
† −→ A† :
⎧
⎪
⎨
⎪
⎩
[x] −→ [xp(1 + δxZ0
)]
,
[y] −→ [yp(1 + δyZ0
)]
(4.12)
(acting on Zq by Frobenius substitution and extended by linearity and continuity) is a
well-defined Zp-algebra morphism that lifts Fp.
Take β,βx, βy ∈ Fq[Z2] with support in 2Γ for which
1 = βf + βxx
∂f
∂x
+ βyy
∂f
∂y
(4.13)
(this is possible due to Corollary 2.13). Let δ, δx, δy be arbitrary Newton polytope pre-
serving lifts of β
p
, β
p
x , β
p
y, respectively. Then clearly Γ(δ), Γ(δx), Γ(δy) ⊂ 2pΓ .
Now let xayb be any monomial such that g(x, y) = xaybf(x, y) has support in N2
and define G(Z) = x−pay−pbgσ(xp(1 + δxZ), yp(1 + δyZ)) ∈ Zq[Z2][Z], where gσ is again
obtained from g by applying Frobenius substitution to the coeﬃcients. Since
G(0) ≡ fp, dG
dZ
(0) ≡ 1 + (aδx + bδy − δ
)
fp modp, (4.14)
we see that [G(Z)] = [0] has a unique solution [Z1] that is congruent to 0modp in the
Henselian ring A†. However, Hensel’s lemma does not provide any information on the
convergence rate of Z1 (or any other representant of [Z1]). To solve this problem, define
H(Z) = G(Z) −
(
aδx + bδy − δ
)
fpZ − fp. (4.15)
Then clearly [G(Z)] = [H(Z)], but now the conditions of Hensel’s lemma are satisfied over
the base ring, so that there exists a unique Z0 ∈ (p) ⊂ Zq〈Z2〉 for whichH(Z0) = 0.
3By Frobenius substitution we mean the map Zq → Zq :
∑
∞
i=0 πip
i → ∑∞i=0 πpi pi , where the πi are Te-
ichmu¨ller representatives.
Computing Zeta Functions of Nondegenerate Curves 27
We have that [Z0] = [Z1]. Note that if we expand
H(Z) =
degH
∑
k=0
hk(x, y)Zk, (4.16)
one easily checks that
Γ
(
hk
) ⊂ (2k + 1)pΓ. (4.17)
Therefore, we can apply Lemma 4.1 and conclude that Z0 =
∑
(i,j)∈Z2 ai,jx
iyj where the
ai,j satisfy
∀i, j ∈ Z, m ∈ N : (i, j) /∈ mΓ =⇒ ord
p
ai,j ≥ m
6p
. (4.18)
Our next step is to investigate what the convergence rate of Z0 tells us about the
convergence rate of Zx = 1 + δxZ0 and Zy = 1 + δyZ0. Write Zx =
∑
(i,j)∈Z2 bi,jx
iyj. We
claim that
∀i, j ∈ Z, m ∈ N : (i, j) /∈ mΓ =⇒ ord
p
bi,j ≥ m
8p
. (4.19)
Indeed, since Z0 ≡ 0modp, this statement is definitely true for m < 8p. If m ≥ 8p, then
(m−2p)/6p ≥ m/8p. Now suppose (i, j) /∈ mΓ . Write δx =
∑
(i,j)∈2pΓ di,jx
iyj. We know that
bi,j =
∑
k+r=i, 
+s=j
dk,
ar,s (4.20)
and since (k, ) ∈ 2pΓ , we know that all (r, s) appearing in the above expansion are not
contained in (m − 2p)Γ . Therefore,
ord
p
bi,j ≥ m − 2p
6p
≥ m
8p
. (4.21)
These observations allow us to state the main result of this section.
Theorem 4.3. There exist units Zx, Zy ∈ Zq〈Z2〉† such that
Fp : A
† −→ A† :
⎧
⎨
⎩
[x] −→ [xpZx
]
,
[y] −→ [ypZy
]
(4.22)
(extended by linearity and continuity and acting on Zq by Frobenius substitution) is a
well-defined Zp-algebra morphism that lifts Fp. Moreover, Zx, Zy, Z−1x , Z
−1
y satisfy the
following convergence criterion: if (i, j) ∈ Z2, m ∈ N are such that (i, j) /∈ mΓ , then the
coeﬃcient of xiyj has p-order > m/9p. 
28 W. Castryck et al.
Proof. It only remains to show that Z−1x and Z
−1
y satisfy the convergence criterion. This
can be done as in the proof of Lemma 4.1. We refer to [4] for a detailed proof. 
Remark 4.4. The larger denominator (9p instead of 8p) is a small price we have to pay
during inversion, but it also allows us to write down a strict inequality (> instead of ≥).
In this form, the convergence criterion is closed under multiplication, that is,
{
∑
(i,j)∈Z2
ai,jx
iyj ∈ Zq
〈
Z
2
〉
| ∀m ∈ N, (i, j) ∈ Z2 : (i, j) /∈ mΓ =⇒ ord
p
ai,j >
m
9p
}
(4.23)
is a ring. We will use this in Section 7.
5 Reduction algorithm
Throughout this section, Γ should again satisfy the assumptions made at the beginning
of Section 3. An important step in our algorithm (see Section 7) is to reduce Laurent poly-
nomials modulo the operator D defined in Section 3. Below we describe a procedure that
solves this problem and prove that, after multiplying with a small power of p, the reduc-
tion process is entirely integral,which enables us to tightly bound the loss of precision.
First, we need a few more theoretical results. Let {t1, . . . , tr} be the edges of Γ ,
let {T1, . . . , Tr} ⊂ XΓ be the corresponding Qq-tori, and let {T1, . . . , Tr} ⊂ XΓ be the corre-
sponding Fq-tori. The reductions modp of the points in Tk ∩C are precisely the points of
Tk ∩ C. For every k = 1, . . . , r,we can find ck, bk ∈ Z such that
xckybk (5.1)
defines a local parameter, at both P and P, for each P ∈ Tk ∩ C. Indeed, these assertions
follow from the proof of Lemma 2.5: ck, bk depend only on the geometry of Γ . If in what
followswe say “local parameter over Zq,” actually any t ∈ Zq[Z2]/(f) for which both t and
its reduction modp are local parameters at P, respectively, P will work.
Below, let Qurq ⊂ Qq denote the maximal unramified extension of Qq and let Zurq
be its valuation ring. Note that all places P ∈ C \ T2
Qq
are defined over Qurq .
Definition 5.1. (1) Let L(0) = Zurq [Z
2], then for any set S of Laurent polynomials, define
S(0) = S ∩ L(0).
Computing Zeta Functions of Nondegenerate Curves 29
(2) Let L(1) be the subset of L(0) consisting of those h for which the following
holds. For every P ∈ C \ T2
Qq
, take a local parameter t over Zq. Then the condition is
that
t
dt
Λ(h) =
∞
∑
i=v
ait
i
(
ai ∈ Zurq
)
(5.2)
satisfies ordp ai ≥ ordp i (alternative notation: i | ai) for all i < 0. For any set S of Laurent
polynomials let S(1) = S ∩ L(1).
Again we remark that the above definitions are vulnerable to notational abuses.
For instance, if S consists of cosets of Laurent polynomials, then S(0) consists of those
Laurent polynomials having a representant in L(0), and so on.
The set L(1) appears naturally4 when we apply the operatorD = xy((∂f/∂y)(∂/∂x)
− (∂f/∂x)(∂/∂y)) that was introduced in Section 3 to an element in L(0).
Lemma 5.2. If h ∈ L(0), thenDh ∈ L(1). 
Proof. Let P ∈ C \ T2
Qq
and let t be a local parameter over Zq at P. By the definition of D,
we have
t
dt
Λ(Dh) =
t
dt
dh. (5.3)
Write h =
∑
∞
i=v bit
i, then clearly (t/dt)dh =
∑
∞
i=v ibit
i,which proves the claim. 
Lemma 5.3. Let D be a divisor on C which is defined over Qq and which has support in
C \ T2
Qq
. Then L(0)(D) is free and finitely generated over Zq. 
Proof. We first prove that the following “strong” version of Theorem 2.9 holds: for every
m ∈ N0, the module L(0)(mDC) is precisely given by L(0)mΓ . Take an element of L(0)mΓ , repre-
sented by some h ∈ Zq[Z2]. By Theorem 2.9, there is an α ∈ Qq[Z2] such that h + αf has
support in mΓ . Write α = α1 + α2, where all coeﬃcients of α1 are integral and all coef-
ficients of α2 are nonintegral. We claim that h + α1f has support in mΓ . Indeed, suppose
this were not true, then α2f has a non-zero term with support outside mΓ . This implies
that α2 has a non-zero term with support outside (m − 1)Γ . Let aijxiyj be such a term.
Then Γ has an edge spanning a line dX + eY = c (with Γ ⊂ {(r, s) | dr + es ≤ c}) such that
4In [13, Proposition 5.3.1], Edixhoven uses a similar set.
30 W. Castryck et al.
di + ej > (m − 1)c. Consider the following monomial order:
xrys ≺ xky
 if dr + es < dk + e or
if dr + es = dk + e, r < k or
if dr + es = dk + e, r = k, s < ,
(5.4)
(where the last line is only of use if e = 0). We may suppose that xiyj is maximal with
respect to ≺. Take the term brsxrys of f that is maximal with respect to ≺ (in particular,
dr + es = c). Then aijbrsxi+ryj+s is a term of α2f with support outside mΓ . Because h +
α1f + α2f has support inmΓ and h + α1f ∈ Zq[Z2], this implies that aijbrs is integral. But
this is impossible, since aij is non-integral and brs is a p-adic unit.
Now since L(0)(D) ⊂ L(0)(mDC) for some big enough m ∈ N0, and since the latter
is finitely generated,we have that L(0)(D) is finitely generated as well. This follows from
a well-known theorem on modules over Noetherian rings. But it is also well known that
every finitely generated and torsion-free module over a principal ideal domain is free,
which concludes the proof. 
For the following two lemmata, fix a point P ∈ C\T2
Qq
and letQqs ⊃ Qq be its field
of definition. Denote the valuation ring with Zqs and the residue field with Fqs . Write
Gal(Qqs ,Qq) = {σ1, σ2, . . . , σs} with σ1 = idQqs . Let P be the divisor
∑s
i=1 P
σi . Note that if
t is a local parameter at P over Zq, then it is a local parameter at any Pσi over Zq.
Lemma 5.4. Let E be an eﬀective divisor on C which is defined over Qq and whose sup-
port is contained inC\T2
Qq
. Assume that degE > 2g−2. Then there exists an h ∈ L(0)
Qsq
(E+P)
such that
(1) h has a pole at P of multiplicity ordP(E) + 1,
(2) let t be a local parameter over Zq at P, then h has an expansion
∑
∞
i=v ait
i
with all ai ∈ Zqs and av a unit in Zqs . 
Proof. Consider the following diagram where the vertical arrows are the natural reduc-
tion modulo pmaps:
L
(0)
Qqs
(E)
⊂
L
(0)
Qqs
(E + P)
LC,Fqs (E)

LC,Fqs (E + P)
(5.5)
The vertical maps are surjective, since after tensoring with Fq they become clearly injec-
tive and hence surjective since both have the same dimension by Riemann-Roch (here we
Computing Zeta Functions of Nondegenerate Curves 31
used the foregoing lemma). Let h ∈ LC,Fqs (E + P) \ LC,Fqs (E) and choose h ∈ L
(0)
Qqs
(E + P)
such that h reduces to hmodp. 
An important feature of the foregoing lemma is the following: if we replace P by
Pσi for some σi ∈ Gal(Qqs ,Qq), then hσi ∈ L(0)Qqs (E + Pσi) again satisfies the above condi-
tions. Indeed, σi(av) is a unit in Zqs .
Lemma 5.5. Let E be an eﬀective divisor on C which is defined over Qq and whose sup-
port is contained in C \ T2
Qq
. Suppose that degE > 2g − 2, then the map
L(0)(E + P) D−→ L
(1)
(
E + DC + P
)
L(1)
(
E + DC
) (5.6)
is surjective. 
Proof. Let h ∈ L(1)(E+DC +P)\L(1)(E+DC). By Corollary 2.7,we have DivΛ(h) = Divh+
DC − WC. Let t be a local parameter over Zq at P, then
ord
P
(
tΛ(h)
dt
)
= ord
P
(h) + ord
P
(
DC
)
= − ord
P
(
E + DC + P
)
+ ord
P
(
DC
)
= − ord
P
(E) − 1 = −n,
(5.7)
with n = ordP(E + P). Therefore,we have a local expansion
tΛ(h)
dt
= b0t
−n + b1t
−n+1 + · · · , (5.8)
at P,with n | b0. Note that the expansions at the conjugate places Pσi are given by
tΛ(h)
dt
= σi
(
b0
)
t−n + σi
(
b1
)
t−n+1 + · · · . (5.9)
Using Lemma 5.4,we find an h0 ∈ L(0)Qqs (E + P) with power series expansion at P:
h0 = a0t
−n + a1t
−n+1 + · · · , (5.10)
and with a0 a p-adic unit. Define
h1 = h +
s
∑
i=1
σi
(
b0
)
nσi
(
a0
)D
(
hσi0
)
= h + D
(
Tr
(
b0
na0
h0
))
∈ L(1)(E + DC + P
)
, (5.11)
32 W. Castryck et al.
then we have the following expansion at P:
tΛ(h1)
dt
=
tΛ(h)
dt
+
b0
na0
tdh0
dt
= 0 · t−n + · · · , (5.12)
and thus ordP(tΛ(h1)/dt) ≥ −n + 1. Similarly, the pole orders at all conjugate places Pσi
are reduced by at least 1. Note that
ord
Pσi
(
tΛ
(
h1
)
dt
)
= ord
Pσi
(
h1
)
+ ord
Pσi
(
DC
)
, (5.13)
since DivΛ(h1) = Divh1+DC−WC. Hencewe see that ordPσi (h1) ≥ −n+1−ordPσi (DC) =
1 − ordPσi (E + DC + P), thus h1 ∈ L(1)(E + DC) which finishes the proof. 
A repeated application of the above lemma gives the following result.
Corollary 5.6. Let E be an eﬀective divisor which is defined over Qq and whose support
is contained in C \ T2
Qq
, then the map
L(0)
(
DC + E
) D−→ L
(1)
(
2DC + E
)
L(1)
(
2DC
) (5.14)
is surjective. 
The above corollary can be turned into a reduction algorithm and also provides a
sharp bound for the loss of precision incurred during reduction. Indeed, since the New-
ton polytope Γ contains the origin as an interior point, any Laurent polynomial h ∈ Zq[Z2]
will be contained in an L(0)mΓ withm ∈ N0 big enough. Let
ε =
⌈
log
p
max
{
− ord
P
(h)
}
P∈C\T2
Qq
⌉
, (5.15)
then clearly pεh ∈ L(1)mΓ . So we can as well assume that h ∈ L(1)mΓ . By Theorem 2.9,we have
L(mDC) = LmΓ and applying Corollary 5.6 with E = (m − 2)DC (we can assume that
m > 2, since otherwise no reduction is necessary), shows that there exists a g ∈ L(0)(m−1)Γ
such that hr = h − D(g) ∈ L(1)(2DC). Note that after multiplication with pε the entire
reduction process is integral, so if we want to recover the result hr modulo pN, we need
to compute hmodulo pN+ε. To finalize the computation,we need to express hr on a basis
for H1DR(C ∩ T2Qq), which could cause a further loss of precision, depending on the basis
chosen. But clearly, as long aswe choose a “Zq-module basis” forH1DR(C∩T2Qq), no further
loss of precision will occur. More precisely,wemean the following. Consider the module
MH =
L(0)
(
2DC
)
D
(
L
(
DC
)) ∩ L(0) , (5.16)
Computing Zeta Functions of Nondegenerate Curves 33
thenMH is a freeZq-module since it is finitely generated and torsion-free. Therefore, any
Zq-basis forMH forms a suitable basis forH1DR(C∩ T2Qq), such that in the final reduction
step, no further loss of precision is incurred.
In the above description, we used any representant for an element of the coordi-
nate ring of C; in practice however, we would like to work with a unique representant.
Given the Newton polytope Γ of f, there are many possibilities to choose a suitable basis
B for Qq[Z2]/(f). The assumptions about Γ made in Section 3 already led to the following
natural choice:
B =
{
xkyl | k, l ∈ Z, db ≤ l < dt
}
, (5.17)
with (ct, dt) (resp., (cb, db)) the unique highest (resp., lowest) point of Γ .
Let S[m1,m2] withm1 < m2 denote the set of Laurent polynomials with support in
the rectangle [m1,m2] × [db, dt − 1], then the reduction process proceeds in two phases:
the first phase reduces terms in S[0,m] with m ∈ N0 and the second phase reduces terms
in S[−m,0] withm ∈ N0. Since both phases are so similar,we will focus mainly on the first
phase and briefly mention the changes for the second phase.
Phase 1. Any element h ∈ S(0)[0,m] can be forced into S(1)[0,m] by multiplying it with pε,where
ε =
⌈
log
p
(
mMx + Δ
)
⌉
(5.18)
with Mx = max {− ordP(x)}P∈C\T2
Qq
and Δ = max {− ordP(ydt−1),− ordP(ydb)}P∈C\T2
Qq
. If
we now want to apply Corollary 5.6 to an element h ∈ S(1)[0,m], we need to find a divisor E
overQq such that S
(1)
[0,m] ⊂ L(1)(2DC+E). Then by Corollary 5.6 there exists a g ∈ L(0)(DC+
E) such that h − D(g) ∈ L(1)(2DC). In practice, however, we do not want to work with
explicit Riemann-Roch spaces; as such we want to find a divisor E (depending onm) and
constants c1, c2 ∈ Z (independent ofm) such that
S[0,m] ⊂ L
(
2DC + E
)
, L
(
DC + E
) ⊂ S[c1,m+c2]. (5.19)
The reduction algorithm then becomes very simple indeed: to reduce h ∈ S(1)[0,m], we only
need to find a g ∈ S(0)[c1,m+c2] such that h − D(g) ∈ L(1)(2DC), using linear algebra.
Recall that the divisor of any function h ∈ Qq(C) can be written as the diﬀerence
of the zero divisor and the pole divisor, that is, Div(h) = Div0(h) − Div∞ (h), Div0(h) ≥ 0,
34 W. Castryck et al.
Div∞ (h) ≥ 0, and Supp(Div0(h)) ∩ Supp(Div∞ (h)) = ∅. Furthermore, two trivial observa-
tions are that h ∈ L(Div∞ (h)) and Div∞ (h−1) = Div0(h). Consider the divisor
Em = −db Div
0
(y) +
(
dt − 1
)
Div
∞
(y) + mDiv
∞
(x), (5.20)
then Em ≥ 0 and S[0,m] ⊂ L(Em) ⊂ L(2DC + Em), so we can apply Corollary 5.6 with
E = Em. Note that Em is indeed defined over Qq.
Remark 5.7. It is clear that the choice for Em is not entirely optimal, since we could sub-
tract the contributions in 2DC and still obtain the above inclusion. The most important
simplification in practice is that 2Γ is “likely” to contain the interval [db, dt − 1] on the
y-axis and then Em can be simply taken to be mDiv∞ (x). However, in general this need
not be the case.
To determine the constants c1 and c2,we first prove the following lemma.
Lemma 5.8. Let E be a divisor on C which is defined over Qq with degE > 2g − 2, and let
h ∈ Qq(C) be a function onC. Then for anym ∈ N0, the followingmap is an isomorphism:
L
(
E + Div
∞
(h)
)
L(E)
·hm−1−−−−−→
L
(
E + mDiv
∞
(h)
)
L
(
E + (m − 1)Div
∞
(h)
) . (5.21)

Proof. Since degE > 2g − 2 and Div∞ (h) ≥ 0, the Riemann-Roch theorem implies that
the dimensions of both vector spaces are equal to degDiv∞ (h), so it suﬃces to prove
injectivity. Let g ∈ L(E+Div∞ (h)) and assume that hm−1g ∈ L(E+ (m− 1)Div∞ (h)), that
is,
(m − 1)Div(h) + Div(g) ≥ −E − (m − 1)Div
∞
(h), (5.22)
which implies that Div(g) ≥ −E − (m − 1)Div0(h). Since g ∈ L(E + Div∞ (h)), that is,
Div(g) ≥ −E−Div∞ (h) and the supports of Div0(h) and Div∞ (h) are disjoint,we conclude
Div(g) ≥ −E or g ∈ L(E). 
In what follows,wewill use the abbreviation Ey = −db Div0(y)+ (dt −1)Div∞ (y),
so Em = Ey + mDiv∞ (x). Choose integers κ1 ≤ 0 and κ2 ≥ 0 such that L(0)(DC + Ey +
Div∞ (x) + Div0(x)) ⊂ S[κ1,κ2]. In particular, L(0)(DC + E1) ⊂ S[κ1,κ2]. This can then be
generalized to the following.
Corollary 5.9. L(DC + Em) ⊂ S[κ1,m−1+κ2].
Computing Zeta Functions of Nondegenerate Curves 35
Proof. Apply Lemma 5.8 with E = DC + Ey and h = x. 
Thus, given h ∈ S(1)[0,m], we find g ∈ S(0)[κ1,m−1+κ2] such that h − D(g) ∈ L(1)(2DC)
using linear algebra over Zq. However, for big m the linear systems involved get quite
large, so we compute g in several steps: let h0 = h and choose a constant c ∈ N0, then in
step 1 ≤ i ≤ t (where twill be determined later)we compute a gi such that
hi = hi−1 − D
(
gi
) ∈ S(1)[0,m−ic]. (5.23)
In the last step, that is, Step (t + 1)we find a gt+1 ∈ S(0)[κ1,m−tc−1+κ2] such that
ht+1 = ht − D
(
gt+1
) ∈ L(1)(2DC
)
. (5.24)
We postpone this last step until after Phase 2, since it is better to treat the last steps of
both phases at once. To determine which monomials appear in the gi for 1 ≤ i ≤ t we
prove the following lemma.
Lemma 5.10. Ifm ∈ N0, k ∈ Z with db ≤ k < dt, thenD(xmyk) ∈ S(1)[κ1+m−1, κ2+m−1]. 
Proof. By definition of D we have D(xmyk) = xmyk(myfy − kxfx). Note that the support
of g = myfy − kxfx is contained in Γ and thus g ∈ L(DC). Furthermore, by definition of
Ey we have yk ∈ L(Ey). Therefore, by definition of κ1 and κ2 we conclude that D(xmyk) ∈
S
(1)
[κ1+m−1, κ2+m−1]
. 
The above lemma finalizes the description of the algorithm: in step i it suﬃces to
take gi in S[ai,bi] with
ai = m − ic − κ2 + 2, bi = m − (i − 1)c + κ2 − 1, (5.25)
and to work modulo xm−ic. There are two natural conditions that t and c should satisfy.
The first one is related to the fact that we want to work in S[0,+∞ ] only. Therefore,
at ≥ −κ1 + 1 which is equivalent with tc ≤ m + κ1 − κ2 + 1. (5.26)
The second condition keeps track of the fact that somethingwhich is already inL(1)(2DC)
cannot be reduced anymore. Therefore, choose integers5 χ1 ≤ 0, χ2 ≥ 0 such that
5The parameters κ1 , κ2 and χ1 , χ2 will be discussed more extensively in Section 7.
36 W. Castryck et al.
L(1)(2DC) ⊂ L[2χ1,2χ2]. It then suﬃces to impose
tc ≤ m − 2χ2. (5.27)
The number of unknowns in the linear system of equations in step i is precisely the num-
ber ofmonomials in S[ai,bi],which equals (dt−db)(c+2κ2−2). Note that this also appears
as a natural upper bound for the number of terms in D(S[ai,bi]) modulo x
m−ic, so we ob-
tain a system with as least as many unknowns as equations.
Phase 2. Since the second phase is very similar to the first, we will only briefly mention
the main diﬀerences. To force an element h ∈ S(0)[−m,0] withm ∈ N0 into S(1)[−m,0],we need to
multiply with pε,where
ε =
⌈
log
p
(
mM1/x + Δ
)
⌉
(5.28)
with M1/x = max {− ordP(x−1)}P∈C\T2
Qq
and Δ as before, so from now on assume that h ∈
S
(1)
[−m,0]. The divisor Em now becomes Em = Ey + mDiv∞ (x
−1), and applying Lemma 5.8
with h = x−1 shows
L
(
DC + Ey + mDiv
∞
(
x−1
)
)
⊂ S[−m+1+κ1,κ2], (5.29)
where κ1, κ2 are chosen as in Phase 1. In step i we now compute a gi such that hi =
hi−1 − D(gi) ∈ S(1)[−m+ic,0] for some constant c ∈ N0. An analogue of Lemma 5.10 (replace
S
(1)
[κ1+m−1,κ2+m−1]
with S(1)[κ1−m+1,κ2−m+1]) finally leads to gi ∈ S
(0)
[ai,bi]
with
ai = −m + (i − 1)c + κ1 + 1, bi = −m + ic − κ1 − 2. (5.30)
The number of steps t is determined by the following inequalities:
tc ≤ m + κ1 − κ2 + 1, tc ≤ m + 2χ1. (5.31)
The systems to be solved have (dt −db)(c−2κ1 −2) unknowns, that are related by at most
the same number of equations.
Step (t + 1). During Phases 1 and 2,we reduced a given polynomial h ∈ L(1) modulo D to
obtain a polynomial ht ∈ S(1)[−n1,n2], where n1 ∈ N0 is roughly of size max {−2χ1, κ2 − κ1}
and n2 ∈ N0 is roughly of size max {2χ2, κ2 − κ1}. In this last step,we reduce to a polyno-
mial ht+1 ∈ L(1)(2DC) by brute force. From Corollary 5.9 (and its Phase 2 analogue), we
Computing Zeta Functions of Nondegenerate Curves 37
know that there is a gt+1 ∈ S(0)[−n1+1+κ1, n2−1+κ2] such that
ht − D
(
gt+1
) ∈ L(1)(2DC
)
, (5.32)
so we can compute ht+1 by solving a system of at most (dt − db)(2(κ2 − κ1) + n1 + n2 − 3)
equations in
(
dt − db
)(
κ2 − κ1 + n1 + n2 − 1
)
+ #
(
2Γ ∩ Z2) (5.33)
unknowns. Here, the latter term equals 4Vol(Γ)+#(∂Γ ∩Z2)+1 by Ehrhart’s theorem [14].
Solving linear systems over Zq. Let r, s ∈ N0 and consider a matrix A ∈ Zr×sq and a
vector b ∈ Zrq. LetN ∈ N0 denote the p-adic precision up to which is to be computed. The
aim is to find an x ∈ Zsq such that A · x ≡ bmodpN. Note that this is slightly weaker than
finding the reductionmodpN of an x ∈ Zsq such thatA ·x = b (exact equality over Zq), but
only slightly: from Lemma 5.11 below it follows that it suﬃces to increase the precision
in order to solve this.
Using Gaussian elimination, where in each step the pivot is taken to have mini-
mal p-adic valuation, one can find invertible matricesN1 ∈ Zr×rq , N2 ∈ Zs×sq such that
N1 ·A ·N2 (5.34)
is a diagonal matrix whose diagonal elements are called the invariant factors of A. We
then have the following lemma (the proof is immediate).
Lemma 5.11. Let θ ∈ N be an upper bound for the p-adic valuations of the non-zero in-
variant factors of A and letN ≥ θ. Let x0 ∈ Zsq satisfy
A · x0 ≡ bmodpN. (5.35)
If there is an x ∈ Zsq such that
A · x = b, (5.36)
then x can be chosen to satisfy x ≡ x0 modpN−θ. 
The method works as follows. First, precompute the invariant factors and the
matricesN1 andN2 (and their inverses)modulo p2θ. In total,we need ˜O(d3nθ) time to do
this,where d = max {r, s} is the dimension of A.
38 W. Castryck et al.
Now suppose we have an x0 such that A · x0 ≡ bmodpN for some N ≥ θ. By
Lemma 5.11,we can find an x of the form x0 + tpN−θ such that A · x ≡ bmodp2N. To this
end,we have to find a t such that
A · t ≡ b − A · x0
pN−θ
modpN+θ. (5.37)
Let T(N) denote the time needed to solve a linear system (with fixed linear part A) up to
precision N, assuming it has a p-adic solution. Then
T(2N) = T(N) + T(N + θ) + ˜O
(
d2nN
)
. (5.38)
Here, the first term comes from the time needed to compute x0. The last term is domi-
nated by the computation of A · x0 modulo p2N. The second term comes from the time
needed to compute t, given (b − A · x0)/pN−θ modp2N. Similarly, T(N + θ) = T(N) +
T(2θ)+ ˜O(d2nN). Using our precomputation and the fact that θ ≤ N,we have that T(2θ) =
˜O(d2nN). In conclusion,
T(2N) = 2T(N) + ˜O
(
d2nN
)
. (5.39)
It is obvious that this recurrence relation still holds ifN < θ (again using our precompu-
tation). From a well-known observation in complexity theory (see, e.g., [46, Lemma 8.2]),
we conclude that
T(N) = ˜O
(
d2nN
)
. (5.40)
Together with our precomputation this results in ˜O(d2nN + d3nθ) bit-operations. The
following lemma concludes this section.
Lemma 5.12. Let m ∈ N0 be the level at which the reduction starts, that is, suppose
that the polynomial to be reduced is in S(0)[−m,m]. The p-adic valuations of the non-zero
invariant factors of the matricesA appearing in our reduction algorithm are bounded by
θ = logp((m + 2(κ2 − κ1 + 1))M + Δ),where
M = max
{
± ord
P
(x)
}
P∈C\T2
Qq
,
Δ = max
{
− ord
P
(
ydt−1
)
,− ord
P
(
ydb
)
}
P∈C\T2
Qq
.
(5.41)

Proof. We claim that A has the following property: if b ∈ pθZrq is such that the system
A · x = b has a solution in Qsq, then it has a solution in Zsq. SinceN1 andN2 are invertible
Computing Zeta Functions of Nondegenerate Curves 39
over Zq, this property then still holds for the matrix N1 · A · N2, from which the result
easily follows.
For simplicity,wewill only prove the claim in caseA comes from the system that
has to be solved during Step (1) of Phase 1. The other cases work similarly. Let b ∈ pθZrq
be such that A · x = b has a solution in Qsq. Then b corresponds to a polynomial
h ∈ S(1)[m−c+1,m+2κ2−2] (5.42)
for which there exists a g ∈ S[m−c−κ2+2,m−1+κ2] such that
h − D(g) ∈ S[0,m−c]. (5.43)
By Corollaries 5.6 and 5.9 (see the first sentence after the proof of Corollary 5.9),we can
reduce this further to eventually obtain a g ∈ S[κ1,m−1+κ2] such that
h − D(g) ∈ L(2DC
)
. (5.44)
Now, let {v1, . . . , vm} be a Qq-basis for
L
(
2DC
)
D
(
L
(
DC
)) . (5.45)
As explained in Section 3, this is also a basis for H1DR(C). In any case, we can find a g0 ∈
L(DC) such that h − D(g) − D(g0) = λ1v1 + · · · + λmvm for some λ1, . . . , λm ∈ Qq.
On the other hand, since h ∈ S(1)[m−c+1,m+2κ2−2] we can find a g ′ ∈ S
(0)
[κ1,m+3κ2−3]
such that
h − D(g ′) ∈ L(2DC
)
, (5.46)
again by Corollaries 5.6 and 5.9. Finally,wefind a g ′0 ∈ L(DC) forwhichh−D(g ′)−D(g ′0) =
μ1v1 + · · · + μmvm for some μ1, . . . , μm ∈ Qq.
Using uniqueness, we conclude that D(g + g0) = D(g ′ + g ′0). Hence d(g + g0) =
ΛD(g+ g0) = ΛD(g ′ + g ′0) = d(g
′ + g ′0) so that g+ g0 and g
′ + g ′0 only diﬀer by a constant.
In particular, g ′ ∈ S(0)[κ1,m−1+κ2]. This concludes the proof. 
6 Commode case
In this section, we discuss the simplifications for a nondegenerate curve with commode
Newton polytope. Note that in practice, this is the most common case.
40 W. Castryck et al.
Definition 6.1. Let K be a field. A bivariate polynomial f ∈ K[N2] is called commode if
∀S ⊂ {x, y} : dim Γ(fS
)
= 2 − |S|, (6.1)
where fS denotes the polynomial obtained from f by setting all variables in S equal to
zero.
The above definition simply means that the Newton polytope Γ(f) contains the
origin, a point (a, 0) with a ∈ N0 and a point (0, b) with b ∈ N0.
In the remainder of this section, we will assume that f ∈ Fq[N2] is commode and
nondegenerate with respect to its Newton polytope Γ , in the following sense. A first con-
sequence of the assumption of commodeness is that A2
Fq
is canonically embedded in XΓ ,
the toric compactification of T2
Fq
with respect to Γ . As such,we can consider XΓ as a com-
pactification of the aﬃne plane, instead of the torus. Therefore, we will work with a no-
tion of nondegenerateness that is slightly weaker than the one given in Section 2: it is no
longer necessary to impose the nondegenerateness conditions with respect to the faces
lying on the coordinate axes. However, we now should explicitly impose that f defines a
nonsingular curve in A2
Fq
. For the remainder of this section, we will use this new notion
of nondegenerateness. The main geometrical diﬀerence with the old notion is that now
we allow our curve to be tangent to the coordinate axes. It is also clear that in practice, all
elliptic, hyperelliptic, and Cab curves can be given by an equation that is nondegenerate
in the above sense. An important remark is that Corollaries 2.13 and 2.14 still hold under
this weaker condition: the proof of Theorem 2.12 can be adapted to the above situation.
Now, letC denote the nonsingular curveV(f), that is, the closure inXΓ of the locus
of f inA2
Fq
. Instead of transforming the curve to the setting described in Section 3,wewill
now work with f itself. If we furthermore assume that f is monic in y, we obtain similar
consequences as in Section 3, that is,
(1) the set S := {xkyl | k, l ∈ N, 0 ≤ l < dy} with dy = degy f is an Fq-basis for
Fq[N2]/(f);
(2) every bivariate polynomial in Fq[N2] has support in mΓ for some big enough
m ∈ N.
Cohomology of commode nondegenerate curves. Take an arbitrary lift f ∈ Zq[N2] of f
with the same Newton polytope Γ , then f is nondegenerate with respect to its Newton
polytope Γ and Γ is commode. Let C denote the nonsingular curve obtained by taking the
closure of the locus of f inXΓ , thenwewill computeH1DR(C∩A2Qq) instead ofH1DR(C∩T2Qq).
Note that the diﬀerence C ∩ (A2
Qq
\ T2
Qq
) consists of dx + dy nonsingular points, with
Computing Zeta Functions of Nondegenerate Curves 41
dx = deg f(x, 0) and dy = deg f(0, y),which by Theorem 3.1 implies that
dimH1DR
(
C ∩ A2
Qq
)
= dimH1MW
(
C ∩ A2
Fq
)
= 2Vol(Γ) − dx − dy + 1. (6.2)
The main diﬀerence with the general case is that Theorem 3.2 needs to be refor-
mulated as follows,where A is now Zq[N2]/(f).
Theorem 6.2. Every element of D1(A)
⊗
Zq
Qq is equivalent modulo d(A)
⊗
Zq
Qq with a
diﬀerential form ωwith divisor
Div
C
(ω) ≥ −DC − VC, (6.3)
where VC is defined as VC = WC−(Tx∩C)−(Ty∩C)with Tx (resp., Ty) the one-dimensional
torus corresponding to the x-axis (resp., y-axis). 
Proof. Note that the support of the divisorDC is disjoint from (Tx ∩C) and from (Ty ∩C)
since the corresponding Nk are zero, which explains the definition of VC. The proof of
Theorem 3.2 then holds with WC replaced by VC. Of course, VC is still defined over Qq.

The definition of Λ remains the same, but we need to restrict it to L(−Div0(x) −
Div0(y)) to obtain a bijection. Indeed,
Div
C
(
Λ(h)
)
= Div
C
(h) + DC − WC
= Div
C
(h) + DC − VC −
(
Tx ∩ C
)
−
(
Ty ∩ C
)
.
(6.4)
Note that Div0(x) = Tx ∩ C and Div0(y) = Ty ∩ C and that the support of DC − VC is
contained in C \ A2
Qq
; therefore, if Λ(h) should have no poles on C ∩ A2
Qq
, then clearly
h ∈ L(−Div0(x) − Div0(y)).
Theorem 6.2 implies that each diﬀerential form in D1(A)
⊗
Zq
Qq is equivalent
modulo exact diﬀerential forms with an ω with divisor DivC(ω) ≥ −DC − VC. Let ω =
Λ(h), then
Div
C
(
Λ(h)
) ≥ −DC − VC ⇐⇒ h ∈ L
(
2DC − Div
0
(x) − Div
0
(y)
)
. (6.5)
Since the support ofDC is disjoint with the support of Div0(x)+Div0(y),we conclude that
L
(
2DC − Div
0
(x) − Div
0
(y)
)
= L
(
2DC
) ∩ L
(
− Div
0
(x) − Div
0
(y)
)
= L−2Γ , (6.6)
where L−2Γ denotes the bivariate polynomials with support in N
2
0∩2Γ . By working modulo
D and f,we finally obtain the following corollary.
42 W. Castryck et al.
Corollary 6.3. If Γ is commode, then Λ induces an isomorphism of Qq-vector spaces:
L−2Γ
fL−Γ + D
(
LΓ
)  H1DR
(
C ∩ A2
Qq
)
. (6.7)

Lifting Frobenius endomorphism. This follows the description given in Section 4,with
the simplification that we now only need to compute the action of Frobenius on x and y.
Reduction algorithm. The reduction in the commode case corresponds to Phase 1 of the
general case as described in Section 5. The main diﬀerence is that the divisor Em simpli-
fies to Em = mDiv∞ (x); since f is commode, we still have S[0,m] ⊂ L(2DC + Em), since
Ey = (dy − 1)Div∞ (y) ≤ DC. Furthermore, if we choose κ such that
L
(
DC + Ey + Div
∞
(x)
)
⊂ S[0,κ], (6.8)
then L(DC + Ey + Em) ⊂ S[0,m−1+κ] andD(S[0,m]) ⊂ S[0,m−1+κ]. The remainder of the algo-
rithm is then exactly the same with κ1 = 0 and κ2 = κ.
7 Detailed algorithm and complexity analysis
7.1 Input and output size analysis
As input, our algorithm expects an f ∈ Fq[Z2] (q = pn, p prime) that is nondegenerate
with respect to its Newton polytope Γ , satisfying conditions 1 and 2 mentioned at the
beginning of Section 3. A good measure for the input size is
number of monomials × (space needed to represent coeﬃcient
+ space needed to represent exponent vector)
(7.1)
which is ∼ #(Γ ∩ Z2) · (logq + log δ),where δ is the degree of f, that is,
max
{
|i| + |j| | (i, j) ∈ Γ}. (7.2)
From a result by Scott [42], that states that #(Γ ∩ Z2) ≤ 3g + 7 whenever g ≥ 1, it follows
that #(Γ ∩Z2) is asymptotically equivalent with g. Note that the number of points on the
boundary R = #(∂Γ ∩ Z2) is bounded by 2g + 7.
As output, our algorithm gives the characteristic polynomial χ(t) := det(F∗q−It) ∈
Z[t] of the Frobenius morphism F∗q acting onH
1
MW(V(f) ∩ T2Fq/Qq). A measure for its size
Computing Zeta Functions of Nondegenerate Curves 43
follows easily from the Weil conjectures. Indeed, its degree equals 2Vol(Γ) + 1, and 2g of
its roots have absolute value q1/2. The other roots correspond to #(∂Γ ∩ Z2) − 1 places
lying on V(f) \ T2
Fq
and have absolute value q. Now, since the ith coeﬃcient of χ(t) is the
sum of ( 2Vol(Γ )+1
i
) i-fold products of such roots,we conclude that an upper bound for the
absolute values of the coeﬃcients is given by
(
2Vol(Γ) + 1
Vol(Γ)
)
qg+R−1 ≤ 22Vol(Γ )+1qg+R−1. (7.3)
Therefore, the number of bits needed to represent χ(t) is
O
((
2Vol(Γ) + 1
) · log (22Vol(Γ )+1qg+R−1)) = O(ng2) (7.4)
for p fixed.
Note that the zeta function of V(f) ∩ T2
Fq
is then given by
ZV(f)∩T2
Fq
(t) =
1
qg+R−1
χ(qt)
1 − qt
. (7.5)
The zeta function of the complete model V(f) can easily be derived from the above; see [4]
for more details.
7.2 Asymptotic estimates of some parameters
We will bound the space and time complexity of our algorithm in terms of n and a set of
parameters that depend only on Γ (note that we assume p fixed). In the following,wewill
often state that some property holds formost common polytopes: this is not intended to
be made mathematically exact. But for instance, the statement will always hold when Γ
has a unique right-most and a unique left-most vertex lying on the x-axis, as well as a
unique top and unique bottom vertex lying on the y-axis.
Themost important parameter is of course g, the number of interior lattice points
of Γ . During complexity analysis, we can interchange g with the volume of Γ or with the
total number of lattice points of Γ , as they are all asymptotically equivalent. Indeed, this
follows from Scott’s result mentioned above, together with Pick’s theorem:
g ≤ #(Γ ∩ Z2) ≤ 3g + 7,
g ≤ Vol(Γ) ≤ 2g + 3
(7.6)
44 W. Castryck et al.
(given g ≥ 1). Recall that it follows that R = (∂Γ ∩ Z2) ≤ 2g + 7. Another parameter is δ,
as defined above. We will also make use of the width w, that is, the maximal diﬀerence
between the first coordinates of two points of Γ , and the height h, that is, dt − db. Of
course, h,w ≤ 2δ ≤ 2w+2h. For most common polytopes,whwill behave like g. However,
easy examples show that w, h are, in general, unbounded for fixed g. For instance, let
Γ = Conv {(1,m), (1,m − 1), (−1,−m), (−1,−m + 1)} for some arbitrarily big m ∈ N. Then
Vol(Γ) = 2,while δ = m + 1; see also Remark 7.1.
Next,we need χ1, χ2 ∈ Z such thatL(mDC) ⊂ S[mχ1,mχ2] for allm ∈ N0. Of course,
χ1 and χ2 are determined by the slopes of the top and bottom edges of Γ . Denote as before
the top vertexwith (ct, dt) and let (a, b) be the clockwise-next vertex. Suppose that a ≥ ct.
Then it is not hard to see that Laurent polynomials with support in the upper half-plane
part ofmΓ reduce (modulo f) into S[−∞ ,mτ],where τ = ct + dt(a − ct)/(dt − b). Now
dt
(
a − ct
)
dt − b
=
(
a − ct
)
+
b
(
a − ct
)
dt − b
≤ w + b(a − ct
) ≤ w + 2Vol(Γ) ≤ 4g + w + 6.
(7.7)
The one but last inequality comes from the fact that the triangle with vertices (0, 0),
(ct, dt), (a, b) is contained in Γ . Its volume equals
adt − ctb
2
≥
(
a − ct
)
b
2
. (7.8)
Therefore, τ ≤ ct + 4g+w+ 6. Using the same argument for the lower half-plane,we con-
clude that L(mDC) ⊂ S[−∞ ,m(max(ct,cb)+4g+w+6)]. This is definitely also true when a < ct.
By analogy, L(mDC) ⊂ S[m(min(ct,cb)−4g−w−6),+∞ ], which proves that we can take χ1, χ2
such that χ2 − χ1 ≤ 8g + 3w + 12. For most common polytopes, h(χ2 − χ1) is expected to
beO(g3/2) (by interchanging x and y if necessary).
Strongly related with the foregoing are optimal κ1, κ2 ∈ Z such that L(DC + Ey +
Div∞ (x)+Div0(x)) ⊂ S[κ1,κ2]; see Corollary 5.9. Note that±ordP(x) ≤ h and±ordP(y) ≤ w
for any place P ∈ C\T2
Qq
: this follows fromCorollary 2.6. Therefore,L(DC+Ey+Div∞ (x)+
Div0(x)) ⊂ L((hw + 2h + 1)DC). By the foregoing,we conclude that we can take κ2 − κ1 =
O(hw(χ2 − χ1)) = O(hw(g + w)), though this is a very rough estimate. For most common
polytopes, a much better bound holds: we can omit Ey (see Remark 5.7) and have that
Div∞ (x) + Div0(x) ≤ 2DC, so we can use the same bound as above (multiplied by 3), that
is, κ2 − κ1 = O(g + w). Again, for most common polytopes h(κ2 − κ1) is expected to be
O(g3/2).
Computing Zeta Functions of Nondegenerate Curves 45
Finally,we will often make use of the trivial estimates g ≤ h(χ2 − χ1), h(κ2 − κ1).
7.3 The algorithm
Remark 7.1. In the introductory section, we mentioned that the Soft-Oh notation
neglects factors that are logarithmic in the input size. From the example given in the
above section, it is clear that factors that are logarithmic in w, h, δ, χ2 − χ1, and κ2 − κ1
need not be logarithmic in the input size. Nevertheless, we will omit them during com-
plexity analysis. This ismainly for sake of simplicity; but on the other hand,we can prove
[4] that there is some “optimal” setting of Γ to be obtained by stretching and skewing, in
whichw, h ∼ g4. Hence also δ, χ2−χ1, and κ2−κ1 are bounded by polynomial expressions
in g. Moreover, the reduction to this optimal setting goes very fast, as it is essentially Eu-
clid’s algorithm for finding shortest vectors in a lattice.
Remark 7.2. We assume that f is given as an array of tuples (coeﬃcient, exponent vec-
tor), that is, ordered with respect to the second components, so that the coeﬃcient cor-
responding to a given exponent vector can be selected in ˜O(1) time. If this is not the case,
this can be easily achieved using a sorting algorithm.
Step 1 (compute p-adic lift of f). First, note that we assume that Fp is represented as
Z/(p) and that Fq is represented as Fp/(r(X)) for some monic irreducible degree n poly-
nomial r(X). Take r(X) ∈ Z[X] such that it has coeﬃcients in {0, . . . , p − 1} and reduces to
r(X) modulo (p). Then Zq can be represented as Zp/(r(X)). Let
an−1[X]n−1 + · · · + a1[X] + a0 (7.9)
be any element of Fq. By the canonical lift to Zq,wemean
an−1[X]n−1 + · · · + a1[X] + a0, (7.10)
where the aj ∈ {0, . . . , p − 1} are the unique elements that reduce to aj mod(p). Finally, if
f =
∑
(i,j)∈Z2∩Γ bijx
iyj, define f =
∑
(i,j)∈Z2∩Γ bijx
iyj where the bij are canonical lifts.
Complexity analysis. This step needs ˜O(ng) time and space.
Step 2 (determine p-adic precision). Assume that all calculations are done modulo pN
for some N ∈ N. What conditions should N satisfy? From the foregoing, it follows that it
46 W. Castryck et al.
suﬃces to compute χ(t) modulo p ˜N,where
˜N ≥
⌈
log
p
(
2
(
2Vol(Γ) + 1
Vol(Γ)
)
qg+R−1
)⌉
. (7.11)
However, during the reduction process (Step 6.2) there is some loss of precision: to en-
sure that everything remains integral,we need to multiply with pε,where
ε =
⌈
log
p
(mM + Δ)
⌉
(7.12)
withM = max {±ordP(x)}P∈C\T2
Qq
, Δ = max {− ordP(ydt−1),− ordP(ydb)}P∈C\T2
Qq
, andm =
max {|m1|, |m2|} the level at which the reduction starts. Here,m1,m2 ∈ Z are such that the
objects to be reduced are in S[m1,m2]. From Corollary 2.6, it is immediate that M ≤ h and
Δ ≤ hw. To see whatm is bounded by, note that the objects to be reduced have support in
(9pN+ 5p)Γ (when computed modulo pN). Indeed, from Step 6.1 we see that these objects
are of the form
yfy
(
Fp
(
xiyj
)
Fp(β)
x∂Fp(x)
Fp(x)∂x
− Fp
(
xiyj
)
Fp(α)
x∂Fp(y)
Fp(y)∂x
)
− xfx
(
Fp
(
xiyj
)
Fp(β)
y∂Fp(x)
Fp(x)∂y
− Fp
(
xiyj
)
Fp(α)
y∂Fp(y)
Fp(y)∂y
)
,
(7.13)
where (i, j) ∈ 2Γ . Here α,β ∈ Zq[Z2] are Laurent polynomials with support in 2Γ for which
1 ≡ αxfx +βyfy mod f (see Corollary 2.13). The bound then follows from Theorem 4.3 and
the remark below it.
Since L(9pN+5p)Γ ⊂ S[(9pN+5p)χ1,(9pN+5p)χ2],we obtain that
ε ≤
⌈
log
p
(
(9pN + 5p)max
{∣
∣χ1
∣
∣, χ2
}
h + hw
)
⌉
. (7.14)
As a consequence, this is a natural bound on the valuations of the denominators appear-
ing in the matrix of F∗p (as computed in Step 8). During Steps 9 and 10, our denominators
could grow up to pn(2Vol(Γ )+1)ε. In conclusion, it suﬃces to takeN such that it satisfies
N ≥
⌈
log
p
(
2
(
2Vol(Γ) + 1
Vol(Γ)
)
qg+R−1
)⌉
+ n
(
2Vol(Γ) + 1
)
⌈
log
p
(
(9pN + 5p)max
{∣
∣χ1
∣
∣, χ2
}
h + hw
)
⌉
.
(7.15)
In particular, N = ˜O(ng).
Computing Zeta Functions of Nondegenerate Curves 47
Step 3 (compute eﬀective Nullstellensatz expansion). In this step, one computes (up to
precision pN) polynomials α,β, γ ∈ Zq[Z2] with support in 2Γ such that
1 = γf + αx
∂f
∂x
+ βy
∂f
∂y
. (7.16)
This defines a linear system A · x = B that can be solved using Gaussian elimination, in
each step of which the pivot is taken to be a p-adic unit. This is possible since the linear
map defined by A is surjective (by Theorem 2.12). In particular, there is no loss of pre-
cision. Note that instead of Gaussian elimination, one can use the method described at
the end of Section 5. In this way, one gains a factor g time. But for the overall complexity
analysis this makes no diﬀerence.
Complexity analysis. Selecting the entries of A takes ˜O(g2) time (see Remark 7.2). One
then needs ˜O(nNg3) = ˜O(n2g4) time andO(nNg2) = ˜O(n2g3) space to solve the system.
Step 4 (compute lift of Frobenius). Take lifts δ, δx, δy ∈ Zq[Z2] of γp, αp, βp and compute
a zero of the polynomial
H(Z) =
(
1 + δxZ
)a(
1 + δyZ
)b
fσ
(
xp
(
1 + δxZ
)
, yp
(
1 + δyZ
))
(7.17)
(as described in Section 4) up to precision pN, using Newton iteration and starting from
the approximate solution 0. Reduce all intermediate calculations modulo f to the basis
{xiyj | db ≤ j < dt} (this is why the terms −(aδx + bδy − δ)fpZ − fp, that were added
for theoretical reasons, can be omitted in the formula for H(Z)). Finally, if we denote the
result by Z0, expand Zx := 1 + δxZ0, Zy := 1 + δyZ0 and compute their inverses up to pre-
cision pN using Newton iteration (again reduce the intermediate calculations modulo f).
Note that if we take a and bminimal, then degH ≤ w + h.
Complexity analysis. Remark that it is better not to expand the polynomialH(Z) (nor its
derivative (dH/dZ)(Z)), but to leave it in the above compact representation. The reason
is that the expanded versions ofH and dH/dZ are very space-costly.
A similar complexity estimate has been made in [10]. The complexity is domi-
nated by the last iteration step, which in its turn is dominated by O(g) computations of
terms of the form
(
1 + δxZ
′)i(1 + δyZ ′
)j
, (7.18)
where Z ′ ∈ S[6pNχ1,6pNχ2], i ∈ {0, . . . , w}, and j ∈ {0, . . . , h} (because of (4.18)). Note that
reducing a polynomial with support in [6pNχ1, 6pNχ2]×[−λdb, λ(dt−1)] (for some λ ∈ N0)
48 W. Castryck et al.
to the basis mentioned above can be done in ˜O(λhN(χ2−χ1) ·g ·nN) = ˜O(λn3g3h(χ2−χ1))
time (at least if we know that all intermediate results are supported in [6pNχ1, 6pNχ2]×Z
modulo pN). Therefore, the overall time complexity of Step 4 amounts to ˜O(n3g4h(χ2−χ1)),
whereas the space complexity is ˜O(n3g2h(χ2 − χ1)). Note that this indeed dominates the
time and space needed to compute the Frobenius substitutions, each of which can be
done in ˜O(n · nN) time (see, e.g., [6, Section 12.5]).
The complexity of computing Zx, Zy, Z−1x , Z
−1
y works similarly and is dominated
by the above.
Step 5 (“precompute” F∗p(dx/xyfy)). Here, F
∗
p is the Qq-vector space endomorphism of
ΩC(C ∩ T2Qq) induced by Fp. Note that dx/fy = βydx − αxdy. Thus
F∗p(dx/xyfy)
= Fp(β)
(
∂Fp(x)
Fp(x)∂x
dx +
∂Fp(x)
Fp(x)∂y
dy
)
− Fp(α)
(
∂Fp(y)
Fp(y)∂x
dx +
∂Fp(y)
Fp(y)∂y
dy
)
=
(
Fp(β)
∂Fp(x)
Fp(x)∂x
− Fp(α)
∂Fp(y)
Fp(y)∂x
)
dx +
(
Fp(β)
∂Fp(x)
Fp(x)∂y
− Fp(α)
∂Fp(y)
Fp(y)∂y
)
dy.
(7.19)
However, as will become clear in the following step, it is more natural to precompute
E := yfy
(
Fp(β)
x∂Fp(x)
Fp(x)∂x
− Fp(α)
x∂Fp(y)
Fp(y)∂x
)
− xfx
(
Fp(β)
y∂Fp(x)
Fp(x)∂y
− Fp(α)
y∂Fp(y)
Fp(y)∂y
)
.
(7.20)
Furthermore, this object has nicer convergence properties, in the sense that it is sup-
ported modulo pN in an easy to determine multiple of Γ ((9pN + 3p)Γ to be precise).
Therefore, we have a good control (in terms of χ1 and χ2) on the size of the objects we
are computing with.
Complexity analysis. The complexity of this step is dominated by the computation of
O(g) expressions of the form ZixZ
j
y, where |i| and |j| are O(δ). As before, this results in
˜O(n3g4h(χ2 − χ1)) time and ˜O(n3g2h(χ2 − χ1)) space.
Step 6 (for every (i, j) ∈ 2Γ).
Step 6.1 (let Frobenius act on xiyj). In this step, one actually computes
Λ−1
(
F∗p
(
Λ
(
xiyj
)))
. (7.21)
Computing Zeta Functions of Nondegenerate Curves 49
Note that F∗p(Λ(x
iyj)) is given by Fp(xiyj)F∗p(dx/xyfy). To translate back, if
F∗p
(
Λ
(
xiyj
))
= gij,1dx + gij,2dy, (7.22)
then
Λ−1
(
F∗p
(
Λ
(
xiyj
)))
= xy
(
fygij,1 − fxgij,2
)
. (7.23)
Therefore,we output
Fp
(
xiyj
) · E, (7.24)
where E is the expression that was precomputed during the foregoing step.
Step 6.2 (reduce moduloD). Using the method described in Section 5, reduce the output
of the foregoing substep (aftermultiplyingwith pε) to obtain polynomials rij ∈ L(1)(2DC)
⊂ L(0)2Γ . Note that we want our output rij to be supported in 2Γ : at this stage, we are no
longer interested in the reduction to the basis {xiyj | db ≤ j < dt}.
Complexity analysis. The complexity of the first substep can be estimated using a meth-
od similar to what we did in Step 5, resulting in ˜O(n3g3h(χ2 − χ1)) time (per monomial)
and ˜O(n3g2h(χ2−χ1)) space. For the second substep, it suﬃces to analyze the complexity
of Phase 1 and Step t+1, as described in Section 5. During Phase 1, one needs to solve
systems of size ∼ h(2κ2 + c). Therefore, it is optimal to choose c = κ2. The number of
systems to be solved is then bounded bym/c = m/κ2. Using similar estimates for Phase 2
and using the analysis made at the end of Section 5, this results in a use of
˜O
(
h2
(
κ2 − κ1
)(
χ2 − χ1
)
nN2 + h3
(
κ2 − κ1
)2(
χ2 − χ1
)
nN
)
(7.25)
time before proceeding to Step t+1. In this final step, one needs to solve a linear system
of sizeO(hmax {κ2 − κ1, χ2 − χ1}), resulting in a time-cost of
˜O
(
h2
(
max
{
κ2 − κ1, χ2 − χ1
})2
nN + h3
(
max
{
κ2 − κ1, χ2 − χ1
})3
n
)
. (7.26)
50 W. Castryck et al.
The extra space needed during Phase 1 and Step t+1 is
˜O
(
h2
(
max
{
κ2 − κ1, χ2 − χ1
})2
nN
)
, (7.27)
though this will in general be dominated by the space needed to store the polynomial h
that is to be reduced,which is ˜O(n3g2h(χ2 − χ1)).
Since Steps 6.1 and 6.2 have to be executed for O(g) monomials, we obtain the
following global estimates for Step 6 a time-cost of
˜O
(
n3g3h2
(
max
{
κ2 − κ1, χ2 − χ1
})2
+ n2g2h3
(
max
{
κ2 − κ1, χ2 − χ1
})3
)
(7.28)
and a space-cost of ˜O(n3gh2(max {κ2 − κ1, χ2 − χ1})2).
Note that our time-estimate dominates the time needed to actually compose the
systems that are to be solved.
Step 7 (compute a Zq-basis ofMH = L(0)(2DC)/(D(L(DC)))(0)). Note that from the proof
of Lemma 5.3,we have thatL(0)(mDC) = L
(0)
mΓ for anym ∈ N0. Therefore,we actually have
to compute a Zq-basis of
L
(0)
2Γ
(
D
(
LΓ
)
+ fLΓ
)(0) . (7.29)
Consider the module D(L(0)Γ ) + fL
(0)
Γ and express a vector A whose entries are the genera-
tors {D(xiyj), fxiyj}(i,j)∈Γ∩Z2 in terms of a vector B whose entries are {xrys}(r,s)∈2Γ∩Z2 :
A = E ·B. (7.30)
Now compute Zq-invertible matricesN1 andN2 (and their inverses) such thatN1 · E ·N2
is a diagonal matrix. Its non-zero entries are the non-zero invariant factors of E and will
be denoted by d1, . . . , d
. If we write
N1 ·A = N1 · E ·N2 ·N−12 ·B, (7.31)
we see that the entries ofN−12 ·B form a basis {f1, . . . , fk} of L(0)2Γ such that {d1f1, . . . , d
f
} is
a basis ofD(L(0)Γ )+ fL
(0)
Γ . It is then easily seen that {f1, . . . , f
} is a basis of (D(LΓ )+ fLΓ )
(0).
Finally, {f
+1, . . . , fk} is a basis ofMH.
When computing modulo a finite precision, some caution is needed: to determine
f
+1, . . . , fk modulo pN, it does not suﬃce to do the above computations modulo the same
precision. During this step (and only during this step), we need to compute modulo
Computing Zeta Functions of Nondegenerate Curves 51
pN+N0 ,whereN0 = n logp(whnp)+ 1 = O(N). Indeed,we claim thatN0 is a strict up-
per bound for the p-adic valuation of any non-zero ( × )-minor of E. As a consequence,
the valuations of the non-zero invariant factors d1, . . . , d
 are also strictly bounded by
N0. Therefore,we will be able to find invertible matrices ˜N1 and ˜N2 such that
˜N1 · E · ˜N−12 (7.32)
is congruent modulo pN+N0 to the above diagonal matrix. The “basis” {˜f
+1, . . . , ˜fk} we
find in this way corresponds modulo pN to the basis mentioned above: if we would want
to finalize the above diagonalization (which was only carried out modulo pN+N0), we
would need to subtract from the ˜fi Laurent polynomials with coeﬃcients divisible by
p(N+N0)/pN0 = pN. Actually, one can check that {˜f
+1, . . . , ˜fk} is a basis itself, but we will
not need this. If in Step 8 we write f
+1, . . . , fk and N2, we actually mean the reductions
modpN of ˜f
+1, . . . , ˜fk and ˜N2 that were computed this way.
It remains to prove the claim, that is, the p-adic valuation of any non-zero (× )-
minor of E is strictly bounded byN0. Let r(X) be the polynomial from Step 1 and let θ ∈ C
be a root of it. Consider K = Q(θ) and let OK be its ring of algebraic integers. Then p =
(p) ⊂ OK is a prime ideal and the p-adic completion of K can be identified with Qq. Under
this identification, E has entries
n−1
∑
i=0
aiθ
i ∈ OK, (7.33)
where the ai ∈ Z satisfy |ai| ≤ 2whp. Since the complex norm of any root of r(X) is
bounded by p by Cauchy’s bound,we conclude that the entries e of E satisfy
∣
∣eij
∣
∣
K
≤ nwhpn ≤ (whnp)n (7.34)
for any Archimedean norm | · |K on K that extends the classical absolute value on Q. Since
an (× )-minorm is the sum of ! -fold products of such entries, it follows that
|m|K ≤ (whnp)
n. (7.35)
Since m is an algebraic integer, from the product formula,we have
|m|−np ≤
∏
|m|K ≤ (whnp)
n2 (7.36)
(if m = 0), where | · |p is scaled such that |p|p = 1/p and where the product is over all
Archimedean norms | · |K on K, to be counted twice if it comes from a nonreal root of r(X).
From this,we finally get that ordp m ≤ n logp(whnp).
52 W. Castryck et al.
Complexity analysis. This step needs O(g3) ring operations, each of which takes ˜O(nN)
time. Therefore, the time complexity of this step is ˜O(n2g4) while the space complexity
amounts to ˜O(n2g3).
Step 8 (compute a matrix of pth power Frobenius). From Step 6, we know that pεxiyj is
mapped to rij. Therefore, it is straightforward to compute the action of Frobenius on
f
+1, . . . , fk and express it in terms of B:
Λ−1F∗pΛp
ε
⎛
⎜
⎜
⎝
f
+1
...
fk
⎞
⎟
⎟
⎠
= F ·B. (7.37)
Since F ·B = F ·N2 ·N−12 ·B,we obtain a matrix of Frobenius as p−ε times an appropriate
submatrix M of F ·N2.
Complexity analysis. The complexity of this step is dominated by the computation of F ·
N2,which takes ˜O(n2g4) time and ˜O(n2g3) space, and by O(g2) Frobenius substitutions,
taking an extra ˜O(g2 · n · nN) = ˜O(n3g3) time.
Step 9 (compute a matrix of qth power Frobenius). The matrix p−εM of the foregoing
step is a matrix of F∗p, which is a Qp-vector space morphism acting on H
1
MW(C ∩ T2Qq).
A matrix of F∗q is then given by p
−nεMn,where Mn = Mσ
n−1 ·Mσn−2 · · ·Mσ ·M.
Mn can be computed using the following method that was presented by Kedlaya
[25]: let n = n1n2 · · · nk be the binary expansion of n and write n ′ = n1n2 · · · nk−1, then we
have the formula
Mn = M
σn
′+nk
n ′ ·Mσ
nk
n ′ ·Mnk (7.38)
by means of which Mn can be computed recursively.
Complexity analysis. Applying some σi (i ≤ n) to a matrix of size O(g) takes ˜O(g2 · n ·
nN) = ˜O(n3g3) time, if we precompute [X]σ
i
as a root of the polynomial r that defines
Zq, using Newton iteration and starting from the approximate solution [X]p
i ∈ Fq. The
complexity of Step 9 is then dominated by O(logn) matrix multiplications and O(logn)
applications of some σi, resulting in ˜O((n + g)n2g3) time. The space needed is ˜O(n2g3).
Step 10 (output the characteristic polynomial of Frobenius). The characteristic polyno-
mial χ˜(t) of Mn can be computed using the classical algorithm based on the reduction
to the Hessenberg form [5, Section 2.4.4]. In each step of this reduction, the pivot should
be chosen to be an entry under the diagonal with minimal p-adic valuation (unless this
Computing Zeta Functions of Nondegenerate Curves 53
exceeds the required precision). In this way, no denominators are introduced. Write
χ˜(t) =
2Vol(Γ )+1
∑
i=0
cit
i. (7.39)
Then the characteristic polynomial of F∗q (or of p
−nεMn) is given by
χ(t) =
2Vol(Γ )+1
∑
i=0
p(i−2Vol(Γ )−1)nεcit
i ∈ Z[t]. (7.40)
This finalizes the description of the algorithm.
Complexity analysis. This needs O(g3 · nN) = ˜O(n2g4) time and ˜O(n2g3) space.
7.4 Main theorem
The above analysis allows us to reformulate Theorem 1.1 in more detail.
Theorem 7.3. There exists a deterministic algorithm to compute the zeta function of a
bivariate Laurent polynomial f ∈ Fpn [Z2] that is nondegenerate with respect to its New-
ton polytope Γ , given that the latter contains the origin and has unique top and bottom
vertices. Let g, h, w, κ1, κ2, χ1, χ2 be as above. Then for fixed p, it has running time
˜O
(
n3g3h2
(
max
{
κ2 − κ1, χ2 − χ1
})2
+ n2g2h3
(
max
{
κ2 − κ1, χ2 − χ1
})3
)
. (7.41)
The space complexity amounts to
˜O
(
n3gh2
(
max
{
κ2 − κ1, χ2 − χ1
})2
)
. (7.42)
The ˜O-notation hides factors that are logarithmic in n, g, w, and, h. For “most common”
polytopes, the estimates h(χ2 − χ1) ≈ h(κ2 − κ1) ≈ g3/2 hold, so that the algorithm needs
˜O(n3g6 + n2g6.5) time and ˜O(n3g4) space. 
Recall from Section 3 that the above conditions on Γ are not restrictive. Note that
in the Cab curve case, a better estimate for h(χ2 − χ1) = h(κ2 − κ1) is g, yielding a time
complexity of ˜O(n3g5) and a space complexity of ˜O(n3g3). This is the same as in the al-
gorithm presented in [10].
54 W. Castryck et al.
8 Conclusions
In this paper, we presented a generalization of Kedlaya’s algorithm to compute the zeta
function of a nondegenerate curve over a finite field of small characteristic. As the condi-
tion of nondegenerateness is generic, the algorithmworks for curves that are defined by a
randomly chosen bivariate Laurent polynomial with givenNewton polytope Γ . It requires
˜O(n3Ψt) amount of time and ˜O(n3Ψs) amount of space, where Ψt, Ψs are functions that
depend on Γ only. For nonexotic choices of Γ ,we have that Ψt ∼ g6.5 and Ψs ∼ g4,where g
is the number of interior lattice points of Γ (which is precisely the geometric genus of the
curve). (In fact, if n  g,whichwill usually be the case,we haveΨt ∼ g6.) In the case of a
Cab curve, we obtain the estimates Ψt ∼ g5 and Ψs ∼ g3, so that the algorithm works (at
least asymptotically) as fast as the one presented in [10]. At this moment, the algorithm
has not yet been fully implemented.
In order to develop the algorithm, we proved a number of theoretical results on
nondegenerate curves that are interesting in their own right, for example, a linear eﬀec-
tive Nullstellensatz for sparse Laurent polynomials in any number of variables. Also,we
adapted the Frobenius lifting technique used in [10] to prove a convergence rate in which
the Newton polytope Γ plays a very natural role.
These results seem to reveal an entirely sparse description of the first Monsky-
Washnitzer cohomology group and the action of Frobenius on it, though this should be
investigated further. In particular, during reduction modulo exact diﬀerentials,we loose
track of the Newton polytope for complexity reasons.
Acknowledgments
The first author is a Research Assistant of the Fund for Scientific Research - Flanders (FWO - Vlaan-
deren). The third author is a Postdoctoral Fellow of the Fund for Scientific Research - Flanders (FWO -
Vlaanderen)
References
[1] M. Aschenbrenner, Ideal membership in polynomial rings over the integers, Journal of the
American Mathematical Society 17 (2004), no. 2, 407–441.
[2] Victor V. Batyrev, Variations of the mixed Hodge structure of aﬃne hypersurfaces in algebraic
tori, Duke Math. J. 69 (1993), no. 2, 349–409.
[3] P. Beelen and R. Pellikaan, The Newton polygon of plane curves with many rational points,
Designs, Codes and Cryptography 21 (2000), no. 1–3, 41–67.
[4] W. Castryck, Point counting on nondegenerate curves, Ph.D. thesis KULeuven 2006,
http://wis.kuleuven.be./algebra/artikles/thesis wouter.pdf.
Computing Zeta Functions of Nondegenerate Curves 55
[5] H. Cohen, A Course in Computational Algebraic Number Theory, Graduate Texts in Mathemat-
ics, vol. 138, Springer, Berlin, 1993.
[6] H. Cohen,G. Frey,R. Avanzi, C. Doche, T. Lange, K. Nguyen, and F. Vercauteren (eds.),Handbook
of Elliptic and Hyperelliptic Curve Cryptography, Discrete Mathematics and Its Applications
(Boca Raton), Chapman & Hall/CRC, Florida, 2006.
[7] D. Cox, J. Little, andD. O’Shea, Ideals,Varieties, andAlgorithms,Undergraduate Texts inMath-
ematics, Springer,New York, 1992.
[8] V. I. Danilov, The geometry of toric varieties, Russian Mathematical Surveys 33 (1978), no. 2,
97–154.
[9] J. Denef and F. Vercauteren, An extension of Kedlaya’s algorithm to hyperelliptic curves in
characteristic 2, Journal of Cryptology 19 (2006), no. 1, 1–25, errata: http://www.wis.kuleu-
ven.be/algebra/denef papers/erratapointcounting.pdf.
[10] , Counting points on Cab curves using Monsky-Washnitzer cohomology, Finite Fields
and Their Applications 12 (2006), no. 1, 78–102, errata: http://www.wis.kuleuven.be/alge-
bra/denef papers/erratapointcounting.pdf.
[11] B. Dwork, On the rationality of the zeta function of an algebraic variety, American Journal of
Mathematics 82 (1960), no. 3, 631–648.
[12] ,Adeformation theory for the zeta function of a hypersurface, Proceedings of the Inter-
national Congress of Mathematicians (Stockholm, 1962), Inst. Mittag-Leﬄer, Djursholm, 1963,
pp. 247–259.
[13] B. Edixhoven, Point counting after Kedlaya, notes of a EIDMA-Stieltjes Graduate course given
in Leiden, 2003.
[14] E. Ehrhart, Sur un proble`me de ge´ome´trie diophantienne line´aire. I. Polye`dres et re´seaux,
Journal fu¨r die Reine und Angewandte Mathematik 226 (1967), 1–29.
[15] N. D. Elkies, E. W. Howe, A. Kresch, B. Poonen, J. L. Wetherell, and M. E. Zieve, Curves of ev-
ery genus with many points, II: asymptotically good families, Duke Mathematical Journal 122
(2004), no. 2, 399–422.
[16] P. Gaudry, Counting points on genus 2 curves over finite fields, slides of a talk given at Durham,
2000, http://www.lix.polytechnique.fr/Labo/Pierrick.Gaudry/papers. en.html.
[17] P. Gaudry and N. Gu¨rel, An extension of Kedlaya’s point-counting algorithm to superelliptic
curves, Advances in Cryptology—ASIACRYPT 2001 (Gold Coast), Lecture Notes in Comput. Sci.,
vol. 2248, Springer, Berlin, 2001, pp. 480–494.
[18] R. Gerkmann, Relative rigid cohomology and point counting on families of elliptic curves,
preprint, 2005.
[19] B. Gru¨nbaum and G. C. Shephard, Pick’s theorem, The American Mathematical Monthly 100
(1993), no. 2, 150–161.
[20] A. G. Hovanskiı˘, Newton polyhedra, and the genus of complete intersections, Funktsional’nyı˘
Analiz i ego Prilozheniya 12 (1978), no. 1, 51–61,English translation in Functional Analysis and
Its Applications 12 (1978), 38–46.
[21] M.-D. Huang and D. Ierardi, Counting points on curves over finite fields, Journal of Symbolic
Computation 25 (1998), no. 1, 1–21.
56 W. Castryck et al.
[22] M.-D. Huang and Y.-C. Wong, An algorithm for approximate counting of points on algebraic
sets over finite fields, Algorithmic Number Theory (Portland,Ore, 1998), Lecture Notes in Com-
put. Sci., vol. 1423, Springer, Berlin, 1998, pp. 514–527.
[23] H. Hubrechts,Memory eﬃcient hyperelliptic curve point counting, preprint, 2006.
[24] N. M. Katz and P. Sarnak, Random Matrices, Frobenius Eigenvalues, and Monodromy, Amer-
ican Mathematical Society Colloquium Publications, vol. 45, American Mathematical Society,
Rhode Island, 1999.
[25] K. S. Kedlaya, Counting points on hyperelliptic curves using Monsky-Washnitzer cohomology,
Journal of the Ramanujan Mathematical Society 16 (2001), no. 4, 323–338.
[26] , Computing zeta functions via p-adic cohomology, Algorithmic Number Theory, Lec-
ture Notes in Comput. Sci., vol. 3076, Springer, Berlin, 2004, pp. 1–17.
[27] K. Kedlaya, Computing zeta functions of nondegenerate toric hypersurfaces, draft.
[28] J. Kolla´r, Sharp eﬀective Nullstellensatz, Journal of the American Mathematical Society 1
(1988), no. 4, 963–975.
[29] A. G. Kushnirenko, Newton polytopes and the Bezout theorem, Functional Analysis and Its Ap-
plications 10 (1976), no. 3, 233–235.
[30] A. G. B. Lauder, Counting solutions to equations in many variables over finite fields, Founda-
tions of Computational Mathematics 4 (2004), no. 3, 221–267.
[31] , Deformation theory and the computation of zeta functions, Proceedings of the Lon-
don Mathematical Society. Third Series 88 (2004), no. 3, 565–602.
[32] R. Lercier and D. Lubicz,A quasi quadratic time algorithm for hyperelliptic curve point count-
ing, to appear in Ramanujan Journal.
[33] J.-F. Mestre, Algorithmes pour compter des points de courbes en petite characte´ristique et en
petit genre, notes of a talk given at Rennes, 2000, http://www.math.jussieu.fr/∼mestre/.
[34] P. Monsky, Formal cohomology. II. The cohomology sequence of a pair, Annals of Mathematics.
Second Series 88 (1968), no. 2, 218–238.
[35] , Formal cohomology. III. Fixed point theorems, Annals of Mathematics. Second Series
93 (1971), no. 2, 315–343.
[36] P. Monsky and G. Washnitzer, Formal cohomology. I, Annals of Mathematics. Second Series 88
(1968), 181–217.
[37] J. Pila, Frobenius maps of abelian varieties and finding roots of unity in finite fields, Mathe-
matics of Computation 55 (1990), no. 192, 745–763.
[38] B. Poonen, Computational aspects of curves of genus at least 2, Algorithmic Number Theory
(Talence, 1996), Lecture Notes in Comput. Sci., vol. 1122, Springer, Berlin, 1996, pp. 283–306.
[39] C. Ritzenthaler, Point counting on genus 3 non hyperelliptic curves, Algorithmic Number The-
ory, Lecture Notes in Comput. Sci., vol. 3076, Springer, Berlin, 2004, pp. 379–394.
[40] T. Satoh, The canonical lift of an ordinary elliptic curve over a finite field and its point count-
ing, Journal of the Ramanujan Mathematical Society 15 (2000), no. 4, 247–270.
[41] R. Schoof, Counting points on elliptic curves over finite fields, Journal de The´orie des Nombres
de Bordeaux 7 (1995), no. 1, 219–254.
[42] P. R. Scott, On convex lattice polygons, Bulletin of the Australian Mathematical Society 15
(1976), no. 3, 395–399.
Computing Zeta Functions of Nondegenerate Curves 57
[43] N. Tsuzuki, Bessel F-isocrystals and an algorithm for computing Kloosterman sums, preprint,
2003.
[44] M. van der Put, The cohomology of Monsky and Washnitzer, Me´moires de la Socie´te´
Mathe´matique de France. Nouvelle Se´rie 23 (1986), 33–59, D. Barsky, and P. Robba (eds.), In-
troductions aux Cohomologies p-Adiques (Luminy, 1984).
[45] F. Vercauteren, Computing zeta functions of curves over finite fields, Ph.D. thesis, Katholieke
Universiteit Leuven, Leuven, 2003.
[46] J. von zur Gathen and J. Gerhard,Modern Computer Algebra,Cambridge University Press,New
York, 1999.
W. Castryck: Department of Mathematics, University of Leuven, Celestijnenlaan 200B, B-3001
Leuven-Heverlee, Belgium
E-mail address: wouter.castryck@wis.kuleuven.be
J. Denef: Department ofMathematics,University of Leuven,Celestijnenlaan 200B,B-3001
Leuven-Heverlee,Belgium
E-mail address: jan.denef@wis.kuleuven.be
F. Vercauteren: Department of Electrical Engineering,University of Leuven,Kasteelpark Arenberg 10,
B-3001 Leuven-Heverlee,Belgium
E-mail address: frederik.vercauteren@esat.kuleuven.be
